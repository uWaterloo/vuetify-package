import './VVirtualTable.sass';
// Components
import VSimpleTable from './VSimpleTable';
import mixins from '../../util/mixins';
// Utiltiies
import { convertToUnit, debounce } from '../../util/helpers';
// Types
const baseMixins = mixins(VSimpleTable);
export default baseMixins.extend().extend({
    name: 'v-virtual-table',
    props: {
        chunkSize: {
            type: Number,
            default: 25,
        },
        headerHeight: {
            type: Number,
            default: 48,
        },
        items: {
            type: Array,
            default: () => ([]),
        },
        rowHeight: {
            type: Number,
            default: 48,
        },
    },
    data: () => ({
        scrollTop: 0,
        oldChunk: 0,
        scrollDebounce: null,
        invalidateCache: false,
    }),
    computed: {
        itemsLength() {
            return this.items.length;
        },
        totalHeight() {
            return (this.itemsLength * this.rowHeight) + this.headerHeight;
        },
        topIndex() {
            return Math.floor(this.scrollTop / this.rowHeight);
        },
        chunkIndex() {
            return Math.floor(this.topIndex / this.chunkSize);
        },
        startIndex() {
            return Math.max(0, (this.chunkIndex * this.chunkSize) - this.chunkSize);
        },
        offsetTop() {
            return Math.max(0, this.startIndex * this.rowHeight);
        },
        stopIndex() {
            return Math.min(this.startIndex + (this.chunkSize * 3), this.itemsLength);
        },
        offsetBottom() {
            return Math.max(0, (this.itemsLength - this.stopIndex - this.startIndex) * this.rowHeight);
        },
    },
    watch: {
        chunkIndex(newValue, oldValue) {
            this.oldChunk = oldValue;
        },
        items() {
            this.cachedItems = null;
            this.$refs.table.scrollTop = 0;
        },
    },
    created() {
        this.cachedItems = null;
    },
    mounted() {
        this.scrollDebounce = debounce(this.onScroll, 50);
        this.$refs.table.addEventListener('scroll', this.scrollDebounce, { passive: true });
    },
    beforeDestroy() {
        this.$refs.table.removeEventListener('scroll', this.scrollDebounce);
    },
    methods: {
        createStyleHeight(height) {
            return {
                height: `${height}px`,
            };
        },
        genBody() {
            if (this.cachedItems === null || this.chunkIndex !== this.oldChunk) {
                this.cachedItems = this.genItems();
                this.oldChunk = this.chunkIndex;
            }
            return this.$createElement('tbody', [
                this.$createElement('tr', { style: this.createStyleHeight(this.offsetTop) }),
                this.cachedItems,
                this.$createElement('tr', { style: this.createStyleHeight(this.offsetBottom) }),
            ]);
        },
        genItems() {
            return this.$scopedSlots.items({ items: this.items.slice(this.startIndex, this.stopIndex) });
        },
        onScroll(e) {
            const target = e.target;
            this.scrollTop = target.scrollTop;
        },
        genTable() {
            return this.$createElement('div', {
                ref: 'table',
                staticClass: 'v-virtual-table__table',
            }, [
                this.$createElement('table', [
                    this.$slots['body.before'],
                    this.genBody(),
                    this.$slots['body.after'],
                ]),
            ]);
        },
        genWrapper() {
            return this.$createElement('div', {
                staticClass: 'v-virtual-table__wrapper',
                style: {
                    height: convertToUnit(this.height),
                },
            }, [
                this.genTable(),
            ]);
        },
    },
    render(h) {
        return h('div', {
            staticClass: 'v-data-table v-virtual-table',
            class: this.classes,
        }, [
            this.$slots.top,
            this.genWrapper(),
            this.$slots.bottom,
        ]);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVlZpcnR1YWxUYWJsZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL1ZEYXRhVGFibGUvVlZpcnR1YWxUYWJsZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLHNCQUFzQixDQUFBO0FBRTdCLGFBQWE7QUFDYixPQUFPLFlBQVksTUFBTSxnQkFBZ0IsQ0FBQTtBQUt6QyxPQUFPLE1BQU0sTUFBTSxtQkFBbUIsQ0FBQTtBQUV0QyxZQUFZO0FBQ1osT0FBTyxFQUFFLGFBQWEsRUFBRSxRQUFRLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQTtBQUU1RCxRQUFRO0FBQ1IsTUFBTSxVQUFVLEdBQUcsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFBO0FBU3ZDLGVBQWUsVUFBVSxDQUFDLE1BQU0sRUFBVyxDQUFDLE1BQU0sQ0FBQztJQUNqRCxJQUFJLEVBQUUsaUJBQWlCO0lBRXZCLEtBQUssRUFBRTtRQUNMLFNBQVMsRUFBRTtZQUNULElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLEVBQUU7U0FDWjtRQUNELFlBQVksRUFBRTtZQUNaLElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLEVBQUU7U0FDWjtRQUNELEtBQUssRUFBRTtZQUNMLElBQUksRUFBRSxLQUFLO1lBQ1gsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDO1NBQ0k7UUFDekIsU0FBUyxFQUFFO1lBQ1QsSUFBSSxFQUFFLE1BQU07WUFDWixPQUFPLEVBQUUsRUFBRTtTQUNaO0tBQ0Y7SUFFRCxJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNYLFNBQVMsRUFBRSxDQUFDO1FBQ1osUUFBUSxFQUFFLENBQUM7UUFDWCxjQUFjLEVBQUUsSUFBVztRQUMzQixlQUFlLEVBQUUsS0FBSztLQUN2QixDQUFDO0lBRUYsUUFBUSxFQUFFO1FBQ1IsV0FBVztZQUNULE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxN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LE1BQU0sQ0FBQztpQkFDbkM7YUFDRixFQUFFO2dCQUNELElBQUksQ0FBQyxRQUFRLEVBQUU7YUFDaEIsQ0FBQyxDQUFBO1FBQ0osQ0FBQztLQUNGO0lBRUQsTUFBTSxDQUFFLENBQUM7UUFDUCxPQUFPLENBQUMsQ0FBQyxLQUFLLEVBQUU7WUFDZCxXQUFXLEVBQUUsOEJBQThCO1lBQzNDLEtBQUssRUFBRSxJQUFJLENBQUMsT0FBTztTQUNwQixFQUFFO1lBQ0QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHO1lBQ2YsSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNqQixJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU07U0FDbkIsQ0FBQyxDQUFBO0lBQ0osQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAnLi9WVmlydHVhbFRhYmxlLnNhc3MnXG5cbi8vIENvbXBvbmVudHNcbmltcG9ydCBWU2ltcGxlVGFibGUgZnJvbSAnLi9WU2ltcGxlVGFibGUnXG5cbi8vIFR5cGVzXG5pbXBvcnQgeyBWTm9kZSwgVk5vZGVDaGlsZHJlbiB9IGZyb20gJ3Z1ZSdcbmltcG9ydCB7IFByb3BWYWxpZGF0b3IgfSBmcm9tICd2dWUvdHlwZXMvb3B0aW9ucydcbmltcG9ydCBtaXhpbnMgZnJvbSAnLi4vLi4vdXRpbC9taXhpbnMnXG5cbi8vIFV0aWx0aWllc1xuaW1wb3J0IHsgY29udmVydFRvVW5pdCwgZGVib3VuY2UgfSBmcm9tICcuLi8uLi91dGlsL2hlbHBlcnMnXG5cbi8vIFR5cGVzXG5jb25zdCBiYXNlTWl4aW5zID0gbWl4aW5zKFZTaW1wbGVUYWJsZSlcblxuaW50ZXJmYWNlIG9wdGlvbnMgZXh0ZW5kcyBJbnN0YW5jZVR5cGU8dHlwZW9mIGJhc2VNaXhpbnM+IHtcbiAgJHJlZnM6IHtcbiAgICB0YWJsZTogSFRNTEVsZW1lbnRcbiAgfVxuICBjYWNoZWRJdGVtczogVk5vZGVDaGlsZHJlblxufVxuXG5leHBvcnQgZGVmYXVsdCBiYXNlTWl4aW5zLmV4dGVuZDxvcHRpb25zPigpLmV4dGVuZCh7XG4gIG5hbWU6ICd2LXZpcnR1YWwtdGFibGUnLFxuXG4gIHByb3BzOiB7XG4gICAgY2h1bmtTaXplOiB7XG4gICAgICB0eXBlOiBOdW1iZXIsXG4gICAgICBkZWZhdWx0OiAyNSxcbiAgICB9LFxuICAgIGhlYWRlckhlaWdodDoge1xuICAgICAgdHlwZTogTnVtYmVyLFxuICAgICAgZGVmYXVsdDogNDgsXG4gICAgfSxcbiAgICBpdGVtczoge1xuICAgICAgdHlwZTogQXJyYXksXG4gICAgICBkZWZhdWx0OiAoKSA9PiAoW10pLFxuICAgIH0gYXMgUHJvcFZhbGlkYXRvcjxhbnlbXT4sXG4gICAgcm93SGVpZ2h0OiB7XG4gICAgICB0eXBlOiBOdW1iZXIsXG4gICAgICBkZWZhdWx0OiA0OCxcbiAgICB9LFxuICB9LFxuXG4gIGRhdGE6ICgpID0+ICh7XG4gICAgc2Nyb2xsVG9wOiAwLFxuICAgIG9sZENodW5rOiAwLFxuICAgIHNjcm9sbERlYm91bmNlOiBudWxsIGFzIGFueSxcbiAgICBpbnZhbGlkYXRlQ2FjaGU6IGZhbHNlLFxuICB9KSxcblxuICBjb21wdXRlZDoge1xuICAgIGl0ZW1zTGVuZ3RoICgpOiBudW1iZXIge1xuICAgICAgcmV0dXJuIHRoaXMuaXRlbXMubGVuZ3RoXG4gICAgfSxcbiAgICB0b3RhbEhlaWdodCAoKTogbnVtYmVyIHtcbiAgICAgIHJldHVybiAodGhpcy5pdGVtc0xlbmd0aCAqIHRoaXMucm93SGVpZ2h0KSArIHRoaXMuaGVhZGVySGVpZ2h0XG4gICAgfSxcbiAgICB0b3BJbmRleCAoKTogbnVtYmVyIHtcbiAgICAgIHJldHVybiBNYXRoLmZsb29yKHRoaXMuc2Nyb2xsVG9wIC8gdGhpcy5yb3dIZWlnaHQpXG4gICAgfSxcbiAgICBjaHVua0luZGV4ICgpOiBudW1iZXIge1xuICAgICAgcmV0dXJuIE1hdGguZmxvb3IodGhpcy50b3BJbmRleCAvIHRoaXMuY2h1bmtTaXplKVxuICAgIH0sXG4gICAgc3RhcnRJbmRleCAoKTogbnVtYmVyIHtcbiAgICAgIHJldHVybiBNYXRoLm1heCgwLCAodGhpcy5jaHVua0luZGV4ICogdGhpcy5jaHVua1NpemUpIC0gdGhpcy5jaHVua1NpemUpXG4gICAgfSxcbiAgICBvZmZzZXRUb3AgKCk6IG51bWJlciB7XG4gICAgICByZXR1cm4gTWF0aC5tYXgoMCwgdGhpcy5zdGFydEluZGV4ICogdGhpcy5yb3dIZWlnaHQpXG4gICAgfSxcbiAgICBzdG9wSW5kZXggKCk6IG51bWJlciB7XG4gICAgICByZXR1cm4gTWF0aC5taW4odGhpcy5zdGFydEluZGV4ICsgKHRoaXMuY2h1bmtTaXplICogMyksIHRoaXMuaXRlbXNMZW5ndGgpXG4gICAgfSxcbiAgICBvZmZzZXRCb3R0b20gKCk6IG51bWJlciB7XG4gICAgICByZXR1cm4gTWF0aC5tYXgoMCwgKHRoaXMuaXRlbXNMZW5ndGggLSB0aGlzLnN0b3BJbmRleCAtIHRoaXMuc3RhcnRJbmRleCkgKiB0aGlzLnJvd0hlaWdodClcbiAgICB9LFxuICB9LFxuXG4gIHdhdGNoOiB7XG4gICAgY2h1bmtJbmRleCAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICB0aGlzLm9sZENodW5rID0gb2xkVmFsdWVcbiAgICB9LFxuICAgIGl0ZW1zICgpIHtcbiAgICAgIHRoaXMuY2FjaGVkSXRlbXMgPSBudWxsXG4gICAgICB0aGlzLiRyZWZzLnRhYmxlLnNjcm9sbFRvcCA9IDBcbiAgICB9LFxuICB9LFxuXG4gIGNyZWF0ZWQgKCkge1xuICAgIHRoaXMuY2FjaGVkSXRlbXMgPSBudWxsXG4gIH0sXG5cbiAgbW91bnRlZCAoKSB7XG4gICAgdGhpcy5zY3JvbGxEZWJvdW5jZSA9IGRlYm91bmNlKHRoaXMub25TY3JvbGwsIDUwKVxuXG4gICAgdGhpcy4kcmVmcy50YWJsZS5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLnNjcm9sbERlYm91bmNlLCB7IHBhc3NpdmU6IHRydWUgfSlcbiAgfSxcblxuICBiZWZvcmVEZXN0cm95ICgpIHtcbiAgICB0aGlzLiRyZWZzLnRhYmxlLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHRoaXMuc2Nyb2xsRGVib3VuY2UpXG4gIH0sXG5cbiAgbWV0aG9kczoge1xuICAgIGNyZWF0ZVN0eWxlSGVpZ2h0IChoZWlnaHQ6IG51bWJlcikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaGVpZ2h0OiBgJHtoZWlnaHR9cHhgLFxuICAgICAgfVxuICAgIH0sXG4gICAgZ2VuQm9keSAoKSB7XG4gICAgICBpZiAodGhpcy5jYWNoZWRJdGVtcyA9PT0gbnVsbCB8fCB0aGlzLmNodW5rSW5kZXggIT09IHRoaXMub2xkQ2h1bmspIHtcbiAgICAgICAgdGhpcy5jYWNoZWRJdGVtcyA9IHRoaXMuZ2VuSXRlbXMoKVxuICAgICAgICB0aGlzLm9sZENodW5rID0gdGhpcy5jaHVua0luZGV4XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzLiRjcmVhdGVFbGVtZW50KCd0Ym9keScsIFtcbiAgICAgICAgdGhpcy4kY3JlYXRlRWxlbWVudCgndHInLCB7IHN0eWxlOiB0aGlzLmNyZWF0ZVN0eWxlSGVpZ2h0KHRoaXMub2Zmc2V0VG9wKSB9KSxcbiAgICAgICAgdGhpcy5jYWNoZWRJdGVtcyxcbiAgICAgICAgdGhpcy4kY3JlYXRlRWxlbWVudCgndHInLCB7IHN0eWxlOiB0aGlzLmNyZWF0ZVN0eWxlSGVpZ2h0KHRoaXMub2Zmc2V0Qm90dG9tKSB9KSxcbiAgICAgIF0pXG4gICAgfSxcbiAgICBnZW5JdGVtcyAoKSB7XG4gICAgICByZXR1cm4gdGhpcy4kc2NvcGVkU2xvdHMuaXRlbXMhKHsgaXRlbXM6IHRoaXMuaXRlbXMuc2xpY2UodGhpcy5zdGFydEluZGV4LCB0aGlzLnN0b3BJbmRleCkgfSlcbiAgICB9LFxuICAgIG9uU2Nyb2xsIChlOiBFdmVudCkge1xuICAgICAgY29uc3QgdGFyZ2V0ID0gZS50YXJnZXQgYXMgRWxlbWVudFxuICAgICAgdGhpcy5zY3JvbGxUb3AgPSB0YXJnZXQuc2Nyb2xsVG9wXG4gICAgfSxcbiAgICBnZW5UYWJsZSAoKSB7XG4gICAgICByZXR1cm4gdGhpcy4kY3JlYXRlRWxlbWVudCgnZGl2Jywge1xuICAgICAgICByZWY6ICd0YWJsZScsXG4gICAgICAgIHN0YXRpY0NsYXNzOiAndi12aXJ0dWFsLXRhYmxlX190YWJsZScsXG4gICAgICB9LCBbXG4gICAgICAgIHRoaXMuJGNyZWF0ZUVsZW1lbnQoJ3RhYmxlJywgW1xuICAgICAgICAgIHRoaXMuJHNsb3RzWydib2R5LmJlZm9yZSddLFxuICAgICAgICAgIHRoaXMuZ2VuQm9keSgpLFxuICAgICAgICAgIHRoaXMuJHNsb3RzWydib2R5LmFmdGVyJ10sXG4gICAgICAgIF0pLFxuICAgICAgXSlcbiAgICB9LFxuICAgIGdlbldyYXBwZXIgKCkge1xuICAgICAgcmV0dXJuIHRoaXMuJGNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtcbiAgICAgICAgc3RhdGljQ2xhc3M6ICd2LXZpcnR1YWwtdGFibGVfX3dyYXBwZXInLFxuICAgICAgICBzdHlsZToge1xuICAgICAgICAgIGhlaWdodDogY29udmVydFRvVW5pdCh0aGlzLmhlaWdodCksXG4gICAgICAgIH0sXG4gICAgICB9LCBbXG4gICAgICAgIHRoaXMuZ2VuVGFibGUoKSxcbiAgICAgIF0pXG4gICAgfSxcbiAgfSxcblxuICByZW5kZXIgKGgpOiBWTm9kZSB7XG4gICAgcmV0dXJuIGgoJ2RpdicsIHtcbiAgICAgIHN0YXRpY0NsYXNzOiAndi1kYXRhLXRhYmxlIHYtdmlydHVhbC10YWJsZScsXG4gICAgICBjbGFzczogdGhpcy5jbGFzc2VzLFxuICAgIH0sIFtcbiAgICAgIHRoaXMuJHNsb3RzLnRvcCxcbiAgICAgIHRoaXMuZ2VuV3JhcHBlcigpLFxuICAgICAgdGhpcy4kc2xvdHMuYm90dG9tLFxuICAgIF0pXG4gIH0sXG59KVxuIl19