import mixins from '../../util/mixins';
import header from './mixins/header';
import { wrapInArray, convertToUnit } from '../../util/helpers';
export default mixins(header).extend({
    name: 'v-data-table-header-desktop',
    methods: {
        genGroupByToggle(header) {
            return this.$createElement('span', {
                on: {
                    click: (e) => {
                        e.stopPropagation();
                        this.$emit('group', header.value);
                    },
                },
            }, ['group']);
        },
        getAria(beingSorted, isDesc) {
            const $t = (key) => this.$vuetify.lang.t(`$vuetify.dataTable.ariaLabel.${key}`);
            let ariaSort = 'none';
            let ariaLabel = [
                $t('sortNone'),
                $t('activateAscending'),
            ];
            if (!beingSorted) {
                return { ariaSort, ariaLabel: ariaLabel.join(' ') };
            }
            if (isDesc) {
                ariaSort = 'descending';
                ariaLabel = [
                    $t('sortDescending'),
                    $t(this.options.mustSort ? 'activateAscending' : 'activateNone'),
                ];
            }
            else {
                ariaSort = 'ascending';
                ariaLabel = [
                    $t('sortAscending'),
                    $t('activateDescending'),
                ];
            }
            return { ariaSort, ariaLabel: ariaLabel.join(' ') };
        },
        genHeader(header) {
            const data = {
                attrs: {
                    role: 'columnheader',
                    scope: 'col',
                    'aria-label': header.text || '',
                },
                style: {
                    width: convertToUnit(header.width),
                    minWidth: convertToUnit(header.width),
                },
                class: [
                    `text-${header.align || 'start'}`,
                    ...wrapInArray(header.class),
                    header.divider && 'v-data-table__divider',
                ],
                on: {},
            };
            const children = [];
            if (header.value === 'data-table-select' && !this.singleSelect) {
                return this.$createElement('th', data, [this.genSelectAll()]);
            }
            children.push(this.$scopedSlots.hasOwnProperty(header.value)
                ? this.$scopedSlots[header.value]({ header })
                : this.$createElement('span', [header.text]));
            if (!this.disableSort && (header.sortable || !header.hasOwnProperty('sortable'))) {
                data.on.click = () => this.$emit('sort', header.value);
                const sortIndex = this.options.sortBy.findIndex(k => k === header.value);
                const beingSorted = sortIndex >= 0;
                const isDesc = this.options.sortDesc[sortIndex];
                data.class.push('sortable');
                const { ariaLabel, ariaSort } = this.getAria(beingSorted, isDesc);
                data.attrs['aria-label'] += `${header.text ? ': ' : ''}${ariaLabel}`;
                data.attrs['aria-sort'] = ariaSort;
                if (beingSorted) {
                    data.class.push('active');
                    data.class.push(isDesc ? 'desc' : 'asc');
                }
                if (header.align === 'end')
                    children.unshift(this.genSortIcon());
                else
                    children.push(this.genSortIcon());
                if (this.options.multiSort && beingSorted) {
                    children.push(this.$createElement('span', { class: 'v-data-table-header__sort-badge' }, [String(sortIndex + 1)]));
                }
            }
            if (this.showGroupBy && header.groupable !== false)
                children.push(this.genGroupByToggle(header));
            return this.$createElement('th', data, children);
        },
    },
    render() {
        return this.$createElement('thead', {
            staticClass: 'v-data-table-header',
        }, [
            this.$createElement('tr', this.headers.map(header => this.genHeader(header))),
        ]);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkRhdGFUYWJsZUhlYWRlckRlc2t0b3AuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WRGF0YVRhYmxlL1ZEYXRhVGFibGVIZWFkZXJEZXNrdG9wLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sTUFBTSxNQUFNLG1CQUFtQixDQUFBO0FBQ3RDLE9BQU8sTUFBTSxNQUFNLGlCQUFpQixDQUFBO0FBQ3BDLE9BQU8sRUFBRSxXQUFXLEVBQUUsYUFBYSxFQUFFLE1BQU0sb0JBQW9CLENBQUE7QUFHL0QsZUFBZSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFDO0lBQ25DLElBQUksRUFBRSw2QkFBNkI7SUFFbkMsT0FBTyxFQUFFO1FBQ1AsZ0JBQWdCLENBQUUsTUFBdUI7WUFDdkMsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sRUFBRTtnQkFDakMsRUFBRSxFQUFFO29CQUNGLEtBQUssRUFBRSxDQUFDLENBQWEsRUFBRSxFQUFFO3dCQUN2QixDQUFDLENBQUMsZUFBZSxFQUFFLENBQUE7d0JBQ25CLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQTtvQkFDbkMsQ0FBQztpQkFDRjthQUNGLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFBO1FBQ2YsQ0FBQztRQUNELE9BQU8sQ0FBRSxXQUFvQixFQUFFLE1BQWU7WUFDNUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxHQUFXLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxnQ0FBZ0MsR0FBRyxFQUFFLENBQUMsQ0FBQTtZQUV2RixJQUFJLFFBQVEsR0FBRyxNQUFNLENBQUE7WUFDckIsSUFBSSxTQUFTLEdBQUc7Z0JBQ2QsRUFBRSxDQUFDLFVBQVUsQ0FBQztnQkFDZCxFQUFFLENBQUMsbUJBQW1CLENBQUM7YUFDeEIsQ0FB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QUFJLE1BQU0sQ0FBQyxTQUFTLEtBQUssS0FBSztnQkFBRSxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFBO1lBRWhHLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFBO1FBQ2xELENBQUM7S0FDRjtJQUVELE1BQU07UUFDSixPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxFQUFFO1lBQ2xDLFdBQVcsRUFBRSxxQkFBcUI7U0FDbkMsRUFBRTtZQUNELElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1NBQzlFLENBQUMsQ0FBQTtJQUNKLENBQUM7Q0FDRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBIZWxwZXJzXG5pbXBvcnQgeyBWTm9kZSwgVk5vZGVEYXRhIH0gZnJvbSAndnVlJ1xuaW1wb3J0IG1peGlucyBmcm9tICcuLi8uLi91dGlsL21peGlucydcbmltcG9ydCBoZWFkZXIgZnJvbSAnLi9taXhpbnMvaGVhZGVyJ1xuaW1wb3J0IHsgd3JhcEluQXJyYXksIGNvbnZlcnRUb1VuaXQgfSBmcm9tICcuLi8uLi91dGlsL2hlbHBlcnMnXG5pbXBvcnQgeyBEYXRhVGFibGVIZWFkZXIgfSBmcm9tICd2dWV0aWZ5L3R5cGVzJ1xuXG5leHBvcnQgZGVmYXVsdCBtaXhpbnMoaGVhZGVyKS5leHRlbmQoe1xuICBuYW1lOiAndi1kYXRhLXRhYmxlLWhlYWRlci1kZXNrdG9wJyxcblxuICBtZXRob2RzOiB7XG4gICAgZ2VuR3JvdXBCeVRvZ2dsZSAoaGVhZGVyOiBEYXRhVGFibGVIZWFkZXIpIHtcbiAgICAgIHJldHVybiB0aGlzLiRjcmVhdGVFbGVtZW50KCdzcGFuJywge1xuICAgICAgICBvbjoge1xuICAgICAgICAgIGNsaWNrOiAoZTogTW91c2VFdmVudCkgPT4ge1xuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKVxuICAgICAgICAgICAgdGhpcy4kZW1pdCgnZ3JvdXAnLCBoZWFkZXIudmFsdWUpXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sIFsnZ3JvdXAnXSlcbiAgICB9LFxuICAgIGdldEFyaWEgKGJlaW5nU29ydGVkOiBib29sZWFuLCBpc0Rlc2M6IGJvb2xlYW4pIHtcbiAgICAgIGNvbnN0ICR0ID0gKGtleTogc3RyaW5nKSA9PiB0aGlzLiR2dWV0aWZ5LmxhbmcudChgJHZ1ZXRpZnkuZGF0YVRhYmxlLmFyaWFMYWJlbC4ke2tleX1gKVxuXG4gICAgICBsZXQgYXJpYVNvcnQgPSAnbm9uZSdcbiAgICAgIGxldCBhcmlhTGFiZWwgPSBbXG4gICAgICAgICR0KCdzb3J0Tm9uZScpLFxuICAgICAgICAkdCgnYWN0aXZhdGVBc2NlbmRpbmcnKSxcbiAgICAgIF1cblxuICAgICAgaWYgKCFiZWluZ1NvcnRlZCkge1xuICAgICAgICByZXR1cm4geyBhcmlhU29ydCwgYXJpYUxhYmVsOiBhcmlhTGFiZWwuam9pbignICcpIH1cbiAgICAgIH1cblxuICAgICAgaWYgKGlzRGVzYykge1xuICAgICAgICBhcmlhU29ydCA9ICdkZXNjZW5kaW5nJ1xuICAgICAgICBhcmlhTGFiZWwgPSBbXG4gICAgICAgICAgJHQoJ3NvcnREZXNjZW5kaW5nJyksXG4gICAgICAgICAgJHQodGhpcy5vcHRpb25zLm11c3RTb3J0ID8gJ2FjdGl2YXRlQXNjZW5kaW5nJyA6ICdhY3RpdmF0ZU5vbmUnKSxcbiAgICAgICAgXVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXJpYVNvcnQgPSAnYXNjZW5kaW5nJ1xuICAgICAgICBhcmlhTGFiZWwgPSBbXG4gICAgICAgICAgJHQoJ3NvcnRBc2NlbmRpbmcnKSxcbiAgICAgICAgICAkdCgnYWN0aXZhdGVEZXNjZW5kaW5nJyksXG4gICAgICAgIF1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHsgYXJpYVNvcnQsIGFyaWFMYWJlbDogYXJpYUxhYmVsLmpvaW4oJyAnKSB9XG4gICAgfSxcbiAgICBnZW5IZWFkZXIgKGhlYWRlcjogRGF0YVRhYmxlSGVhZGVyKSB7XG4gICAgICBjb25zdCBkYXRhOiBSZXF1aXJlZDxQaWNrPFZOb2RlRGF0YSwgJ2F0dHJzJyB8ICdvbicgfCAnY2xhc3MnIHwgJ3N0eWxlJz4+ID0ge1xuICAgICAgICBhdHRyczoge1xuICAgICAgICAgIHJvbGU6ICdjb2x1bW5oZWFkZXInLFxuICAgICAgICAgIHNjb3BlOiAnY29sJyxcbiAgICAgICAgICAnYXJpYS1sYWJlbCc6IGhlYWRlci50ZXh0IHx8ICcnLFxuICAgICAgICB9LFxuICAgICAgICBzdHlsZToge1xuICAgICAgICAgIHdpZHRoOiBjb252ZXJ0VG9Vbml0KGhlYWRlci53aWR0aCksXG4gICAgICAgICAgbWluV2lkdGg6IGNvbnZlcnRUb1VuaXQoaGVhZGVyLndpZHRoKSxcbiAgICAgICAgfSxcbiAgICAgICAgY2xhc3M6IFtcbiAgICAgICAgICBgdGV4dC0ke2hlYWRlci5hbGlnbiB8fCAnc3RhcnQnfWAsXG4gICAgICAgICAgLi4ud3JhcEluQXJyYXkoaGVhZGVyLmNsYXNzKSxcbiAgICAgICAgICBoZWFkZXIuZGl2aWRlciAmJiAndi1kYXRhLXRhYmxlX19kaXZpZGVyJyxcbiAgICAgICAgXSxcbiAgICAgICAgb246IHt9LFxuICAgICAgfVxuICAgICAgY29uc3QgY2hpbGRyZW4gPSBbXVxuXG4gICAgICBpZiAoaGVhZGVyLnZhbHVlID09PSAnZGF0YS10YWJsZS1zZWxlY3QnICYmICF0aGlzLnNpbmdsZVNlbGVjdCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kY3JlYXRlRWxlbWVudCgndGgnLCBkYXRhLCBbdGhpcy5nZW5TZWxlY3RBbGwoKV0pXG4gICAgICB9XG5cbiAgICAgIGNoaWxkcmVuLnB1c2goXG4gICAgICAgIHRoaXMuJHNjb3BlZFNsb3RzLmhhc093blByb3BlcnR5KGhlYWRlci52YWx1ZSlcbiAgICAgICAgICA/IHRoaXMuJHNjb3BlZFNsb3RzW2hlYWRlci52YWx1ZV0hKHsgaGVhZGVyIH0pXG4gICAgICAgICAgOiB0aGlzLiRjcmVhdGVFbGVtZW50KCdzcGFuJywgW2hlYWRlci50ZXh0XSlcbiAgICAgIClcblxuICAgICAgaWYgKCF0aGlzLmRpc2FibGVTb3J0ICYmIChoZWFkZXIuc29ydGFibGUgfHwgIWhlYWRlci5oYXNPd25Qcm9wZXJ0eSgnc29ydGFibGUnKSkpIHtcbiAgICAgICAgZGF0YS5vbi5jbGljayA9ICgpID0+IHRoaXMuJGVtaXQoJ3NvcnQnLCBoZWFkZXIudmFsdWUpXG5cbiAgICAgICAgY29uc3Qgc29ydEluZGV4ID0gdGhpcy5vcHRpb25zLnNvcnRCeS5maW5kSW5kZXgoayA9PiBrID09PSBoZWFkZXIudmFsdWUpXG4gICAgICAgIGNvbnN0IGJlaW5nU29ydGVkID0gc29ydEluZGV4ID49IDBcbiAgICAgICAgY29uc3QgaXNEZXNjID0gdGhpcy5vcHRpb25zLnNvcnREZXNjW3NvcnRJbmRleF1cblxuICAgICAgICBkYXRhLmNsYXNzLnB1c2goJ3NvcnRhYmxlJylcblxuICAgICAgICBjb25zdCB7IGFyaWFMYWJlbCwgYXJpYVNvcnQgfSA9IHRoaXMuZ2V0QXJpYShiZWluZ1NvcnRlZCwgaXNEZXNjKVxuXG4gICAgICAgIGRhdGEuYXR0cnNbJ2FyaWEtbGFiZWwnXSArPSBgJHtoZWFkZXIudGV4dCA/ICc6ICcgOiAnJ30ke2FyaWFMYWJlbH1gXG4gICAgICAgIGRhdGEuYXR0cnNbJ2FyaWEtc29ydCddID0gYXJpYVNvcnRcblxuICAgICAgICBpZiAoYmVpbmdTb3J0ZWQpIHtcbiAgICAgICAgICBkYXRhLmNsYXNzLnB1c2goJ2FjdGl2ZScpXG4gICAgICAgICAgZGF0YS5jbGFzcy5wdXNoKGlzRGVzYyA/ICdkZXNjJyA6ICdhc2MnKVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGhlYWRlci5hbGlnbiA9PT0gJ2VuZCcpIGNoaWxkcmVuLnVuc2hpZnQodGhpcy5nZW5Tb3J0SWNvbigpKVxuICAgICAgICBlbHNlIGNoaWxkcmVuLnB1c2godGhpcy5nZW5Tb3J0SWNvbigpKVxuXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMubXVsdGlTb3J0ICYmIGJlaW5nU29ydGVkKSB7XG4gICAgICAgICAgY2hpbGRyZW4ucHVzaCh0aGlzLiRjcmVhdGVFbGVtZW50KCdzcGFuJywgeyBjbGFzczogJ3YtZGF0YS10YWJsZS1oZWFkZXJfX3NvcnQtYmFkZ2UnIH0sIFtTdHJpbmcoc29ydEluZGV4ICsgMSldKSlcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5zaG93R3JvdXBCeSAmJiBoZWFkZXIuZ3JvdXBhYmxlICE9PSBmYWxzZSkgY2hpbGRyZW4ucHVzaCh0aGlzLmdlbkdyb3VwQnlUb2dnbGUoaGVhZGVyKSlcblxuICAgICAgcmV0dXJuIHRoaXMuJGNyZWF0ZUVsZW1lbnQoJ3RoJywgZGF0YSwgY2hpbGRyZW4pXG4gICAgfSxcbiAgfSxcblxuICByZW5kZXIgKCk6IFZOb2RlIHtcbiAgICByZXR1cm4gdGhpcy4kY3JlYXRlRWxlbWVudCgndGhlYWQnLCB7XG4gICAgICBzdGF0aWNDbGFzczogJ3YtZGF0YS10YWJsZS1oZWFkZXInLFxuICAgIH0sIFtcbiAgICAgIHRoaXMuJGNyZWF0ZUVsZW1lbnQoJ3RyJywgdGhpcy5oZWFkZXJzLm1hcChoZWFkZXIgPT4gdGhpcy5nZW5IZWFkZXIoaGVhZGVyKSkpLFxuICAgIF0pXG4gIH0sXG59KVxuIl19