// Styles
import './VCalendarWeekly.sass';
// Components
import VBtn from '../VBtn';
// Mixins
import CalendarBase from './mixins/calendar-base';
// Util
import { getSlot } from '../../util/helpers';
import { weekNumber } from '../../util/dateTimeUtils';
import props from './util/props';
import { createDayList, getDayIdentifier, createNativeLocaleFormatter, } from './util/timestamp';
/* @vue/component */
export default CalendarBase.extend({
    name: 'v-calendar-weekly',
    props: props.weeks,
    computed: {
        staticClass() {
            return 'v-calendar-weekly';
        },
        classes() {
            return this.themeClasses;
        },
        parsedMinWeeks() {
            return parseInt(this.minWeeks);
        },
        days() {
            const minDays = this.parsedMinWeeks * this.parsedWeekdays.length;
            const start = this.getStartOfWeek(this.parsedStart);
            const end = this.getEndOfWeek(this.parsedEnd);
            return createDayList(start, end, this.times.today, this.weekdaySkips, Number.MAX_SAFE_INTEGER, minDays);
        },
        todayWeek() {
            const today = this.times.today;
            const start = this.getStartOfWeek(today);
            const end = this.getEndOfWeek(today);
            return createDayList(start, end, today, this.weekdaySkips, this.parsedWeekdays.length, this.parsedWeekdays.length);
        },
        monthFormatter() {
            if (this.monthFormat) {
                return this.monthFormat;
            }
            const longOptions = { timeZone: 'UTC', month: 'long' };
            const shortOptions = { timeZone: 'UTC', month: 'short' };
            return createNativeLocaleFormatter(this.currentLocale, (_tms, short) => short ? shortOptions : longOptions);
        },
    },
    methods: {
        isOutside(day) {
            const dayIdentifier = getDayIdentifier(day);
            return dayIdentifier < getDayIdentifier(this.parsedStart) ||
                dayIdentifier > getDayIdentifier(this.parsedEnd);
        },
        genHead() {
            return this.$createElement('div', {
                staticClass: 'v-calendar-weekly__head',
            }, this.genHeadDays());
        },
        genHeadDays() {
            const header = this.todayWeek.map(this.genHeadDay);
            if (this.showWeek) {
                header.unshift(this.$createElement('div', {
                    staticClass: 'v-calendar-weekly__head-weeknumber',
                }));
            }
            return header;
        },
        genHeadDay(day, index) {
            const outside = this.isOutside(this.days[index]);
            const color = day.present ? this.color : undefined;
            return this.$createElement('div', this.setTextColor(color, {
                key: day.date,
                staticClass: 'v-calendar-weekly__head-weekday',
                class: this.getRelativeClasses(day, outside),
            }), this.weekdayFormatter(day, this.shortWeekdays));
        },
        genWeeks() {
            const days = this.days;
            const weekDays = this.parsedWeekdays.length;
            const weeks = [];
            for (let i = 0; i < days.length; i += weekDays) {
                weeks.push(this.genWeek(days.slice(i, i + weekDays), this.getWeekNumber(days[i])));
            }
            return weeks;
        },
        genWeek(week, weekNumber) {
            const weekNodes = week.map((day, index) => this.genDay(day, index, week));
            if (this.showWeek) {
                weekNodes.unshift(this.genWeekNumber(weekNumber));
            }
            return this.$createElement('div', {
                key: week[0].date,
                staticClass: 'v-calendar-weekly__week',
            }, weekNodes);
        },
        getWeekNumber(determineDay) {
            return weekNumber(determineDay.year, determineDay.month - 1, determineDay.day, this.parsedWeekdays[0], parseInt(this.localeFirstDayOfYear));
        },
        genWeekNumber(weekNumber) {
            return this.$createElement('div', {
                staticClass: 'v-calendar-weekly__weeknumber',
            }, [
                this.$createElement('small', String(weekNumber)),
            ]);
        },
        genDay(day, index, week) {
            const outside = this.isOutside(day);
            return this.$createElement('div', {
                key: day.date,
                staticClass: 'v-calendar-weekly__day',
                class: this.getRelativeClasses(day, outside),
                on: this.getDefaultMouseEventHandlers(':day', nativeEvent => {
                    return { nativeEvent, ...day };
                }),
            }, [
                this.genDayLabel(day),
                ...(getSlot(this, 'day', () => ({ outside, index, week, ...day })) || []),
            ]);
        },
        genDayLabel(day) {
            return this.$createElement('div', {
                staticClass: 'v-calendar-weekly__day-label',
            }, getSlot(this, 'day-label', day) || [this.genDayLabelButton(day)]);
        },
        genDayLabelButton(day) {
            const color = day.present ? this.color : 'transparent';
            const hasMonth = day.day === 1 && this.showMonthOnFirst;
            return this.$createElement(VBtn, {
                props: {
                    color,
                    fab: true,
                    depressed: true,
                    small: true,
                },
                on: this.getMouseEventHandlers({
                    'click:date': { event: 'click', stop: true },
                    'contextmenu:date': { event: 'contextmenu', stop: true, prevent: true, result: false },
                }, nativeEvent => ({ nativeEvent, ...day })),
            }, hasMonth
                ? this.monthFormatter(day, this.shortMonths) + ' ' + this.dayFormatter(day, false)
                : this.dayFormatter(day, false));
        },
        genDayMonth(day) {
            const color = day.present ? this.color : undefined;
            return this.$createElement('div', this.setTextColor(color, {
                staticClass: 'v-calendar-weekly__day-month',
            }), getSlot(this, 'day-month', day) || this.monthFormatter(day, this.shortMonths));
        },
    },
    render(h) {
        return h('div', {
            staticClass: this.staticClass,
            class: this.classes,
            on: {
                dragstart: (e) => {
                    e.preventDefault();
                },
            },
        }, [
            !this.hideHeader ? this.genHead() : '',
            ...this.genWeeks(),
        ]);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkNhbGVuZGFyV2Vla2x5LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvVkNhbGVuZGFyL1ZDYWxlbmRhcldlZWtseS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxTQUFTO0FBQ1QsT0FBTyx3QkFBd0IsQ0FBQTtBQUsvQixhQUFhO0FBQ2IsT0FBTyxJQUFJLE1BQU0sU0FBUyxDQUFBO0FBRTFCLFNBQVM7QUFDVCxPQUFPLFlBQVksTUFBTSx3QkFBd0IsQ0FBQTtBQUVqRCxPQUFPO0FBQ1AsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLG9CQUFvQixDQUFBO0FBQzVDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQTtBQUNyRCxPQUFPLEtBQUssTUFBTSxjQUFjLENBQUE7QUFDaEMsT0FBTyxFQUNMLGFBQWEsRUFDYixnQkFBZ0IsRUFDaEIsMkJBQTJCLEdBQzVCLE1BQU0sa0JBQWtCLENBQUE7QUFHekIsb0JBQW9CO0FBQ3BCLGVBQWUsWUFBWSxDQUFDLE1BQU0sQ0FBQztJQUNqQyxJQUFJLEVBQUUsbUJBQW1CO0lBRXpCLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSztJQUVsQixRQUFRLEVBQUU7UUFDUixXQUFXO1lBQ1QsT0FBTyxtQkFBbUIsQ0FBQTtRQUM1QixDQUFDO1FBQ0QsT0FBTztZQUNMLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQTtRQUMxQixDQUFDO1FBQ0QsY0FBYztZQUNaLE9BQU8sUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQTtRQUNoQyxDQUFDO1FBQ0QsSUFBSTtZQUNGLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUE7WUFDaEUsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUE7WUFDbkQsTUFBTSxHQUFHLEdBQUcs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QUFPLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUN0QyxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUU7U0FDbkIsQ0FBQyxDQUFBO0lBQ0osQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIFN0eWxlc1xuaW1wb3J0ICcuL1ZDYWxlbmRhcldlZWtseS5zYXNzJ1xuXG4vLyBUeXBlc1xuaW1wb3J0IHsgVk5vZGUgfSBmcm9tICd2dWUnXG5cbi8vIENvbXBvbmVudHNcbmltcG9ydCBWQnRuIGZyb20gJy4uL1ZCdG4nXG5cbi8vIE1peGluc1xuaW1wb3J0IENhbGVuZGFyQmFzZSBmcm9tICcuL21peGlucy9jYWxlbmRhci1iYXNlJ1xuXG4vLyBVdGlsXG5pbXBvcnQgeyBnZXRTbG90IH0gZnJvbSAnLi4vLi4vdXRpbC9oZWxwZXJzJ1xuaW1wb3J0IHsgd2Vla051bWJlciB9IGZyb20gJy4uLy4uL3V0aWwvZGF0ZVRpbWVVdGlscydcbmltcG9ydCBwcm9wcyBmcm9tICcuL3V0aWwvcHJvcHMnXG5pbXBvcnQge1xuICBjcmVhdGVEYXlMaXN0LFxuICBnZXREYXlJZGVudGlmaWVyLFxuICBjcmVhdGVOYXRpdmVMb2NhbGVGb3JtYXR0ZXIsXG59IGZyb20gJy4vdXRpbC90aW1lc3RhbXAnXG5pbXBvcnQgeyBDYWxlbmRhclRpbWVzdGFtcCwgQ2FsZW5kYXJGb3JtYXR0ZXIgfSBmcm9tICd2dWV0aWZ5L3R5cGVzJ1xuXG4vKiBAdnVlL2NvbXBvbmVudCAqL1xuZXhwb3J0IGRlZmF1bHQgQ2FsZW5kYXJCYXNlLmV4dGVuZCh7XG4gIG5hbWU6ICd2LWNhbGVuZGFyLXdlZWtseScsXG5cbiAgcHJvcHM6IHByb3BzLndlZWtzLFxuXG4gIGNvbXB1dGVkOiB7XG4gICAgc3RhdGljQ2xhc3MgKCk6IHN0cmluZyB7XG4gICAgICByZXR1cm4gJ3YtY2FsZW5kYXItd2Vla2x5J1xuICAgIH0sXG4gICAgY2xhc3NlcyAoKTogb2JqZWN0IHtcbiAgICAgIHJldHVybiB0aGlzLnRoZW1lQ2xhc3Nlc1xuICAgIH0sXG4gICAgcGFyc2VkTWluV2Vla3MgKCk6IG51bWJlciB7XG4gICAgICByZXR1cm4gcGFyc2VJbnQodGhpcy5taW5XZWVrcylcbiAgICB9LFxuICAgIGRheXMgKCk6IENhbGVuZGFyVGltZXN0YW1wW10ge1xuICAgICAgY29uc3QgbWluRGF5cyA9IHRoaXMucGFyc2VkTWluV2Vla3MgKiB0aGlzLnBhcnNlZFdlZWtkYXlzLmxlbmd0aFxuICAgICAgY29uc3Qgc3RhcnQgPSB0aGlzLmdldFN0YXJ0T2ZXZWVrKHRoaXMucGFyc2VkU3RhcnQpXG4gICAgICBjb25zdCBlbmQgPSB0aGlzLmdldEVuZE9mV2Vlayh0aGlzLnBhcnNlZEVuZClcblxuICAgICAgcmV0dXJuIGNyZWF0ZURheUxpc3QoXG4gICAgICAgIHN0YXJ0LFxuICAgICAgICBlbmQsXG4gICAgICAgIHRoaXMudGltZXMudG9kYXksXG4gICAgICAgIHRoaXMud2Vla2RheVNraXBzLFxuICAgICAgICBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUixcbiAgICAgICAgbWluRGF5c1xuICAgICAgKVxuICAgIH0sXG4gICAgdG9kYXlXZWVrICgpOiBDYWxlbmRhclRpbWVzdGFtcFtdIHtcbiAgICAgIGNvbnN0IHRvZGF5ID0gdGhpcy50aW1lcy50b2RheVxuICAgICAgY29uc3Qgc3RhcnQgPSB0aGlzLmdldFN0YXJ0T2ZXZWVrKHRvZGF5KVxuICAgICAgY29uc3QgZW5kID0gdGhpcy5nZXRFbmRPZldlZWsodG9kYXkpXG5cbiAgICAgIHJldHVybiBjcmVhdGVEYXlMaXN0KFxuICAgICAgICBzdGFydCxcbiAgICAgICAgZW5kLFxuICAgICAgICB0b2RheSxcbiAgICAgICAgdGhpcy53ZWVrZGF5U2tpcHMsXG4gICAgICAgIHRoaXMucGFyc2VkV2Vla2RheXMubGVuZ3RoLFxuICAgICAgICB0aGlzLnBhcnNlZFdlZWtkYXlzLmxlbmd0aFxuICAgICAgKVxuICAgIH0sXG4gICAgbW9udGhGb3JtYXR0ZXIgKCk6IENhbGVuZGFyRm9ybWF0dGVyIHtcbiAgICAgIGlmICh0aGlzLm1vbnRoRm9ybWF0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1vbnRoRm9ybWF0IGFzIENhbGVuZGFyRm9ybWF0dGVyXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGxvbmdPcHRpb25zID0geyB0aW1lWm9uZTogJ1VUQycsIG1vbnRoOiAnbG9uZycgfVxuICAgICAgY29uc3Qgc2hvcnRPcHRpb25zID0geyB0aW1lWm9uZTogJ1VUQycsIG1vbnRoOiAnc2hvcnQnIH1cblxuICAgICAgcmV0dXJuIGNyZWF0ZU5hdGl2ZUxvY2FsZUZvcm1hdHRlcihcbiAgICAgICAgdGhpcy5jdXJyZW50TG9jYWxlLFxuICAgICAgICAoX3Rtcywgc2hvcnQpID0+IHNob3J0ID8gc2hvcnRPcHRpb25zIDogbG9uZ09wdGlvbnNcbiAgICAgIClcbiAgICB9LFxuICB9LFxuXG4gIG1ldGhvZHM6IHtcbiAgICBpc091dHNpZGUgKGRheTogQ2FsZW5kYXJUaW1lc3RhbXApOiBib29sZWFuIHtcbiAgICAgIGNvbnN0IGRheUlkZW50aWZpZXIgPSBnZXREYXlJZGVudGlmaWVyKGRheSlcblxuICAgICAgcmV0dXJuIGRheUlkZW50aWZpZXIgPCBnZXREYXlJZGVudGlmaWVyKHRoaXMucGFyc2VkU3RhcnQpIHx8XG4gICAgICAgICAgICAgZGF5SWRlbnRpZmllciA+IGdldERheUlkZW50aWZpZXIodGhpcy5wYXJzZWRFbmQpXG4gICAgfSxcbiAgICBnZW5IZWFkICgpOiBWTm9kZSB7XG4gICAgICByZXR1cm4gdGhpcy4kY3JlYXRlRWxlbWVudCgnZGl2Jywge1xuICAgICAgICBzdGF0aWNDbGFzczogJ3YtY2FsZW5kYXItd2Vla2x5X19oZWFkJyxcbiAgICAgIH0sIHRoaXMuZ2VuSGVhZERheXMoKSlcbiAgICB9LFxuICAgIGdlbkhlYWREYXlzICgpOiBWTm9kZVtdIHtcbiAgICAgIGNvbnN0IGhlYWRlciA9IHRoaXMudG9kYXlXZWVrLm1hcCh0aGlzLmdlbkhlYWREYXkpXG5cbiAgICAgIGlmICh0aGlzLnNob3dXZWVrKSB7XG4gICAgICAgIGhlYWRlci51bnNoaWZ0KHRoaXMuJGNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtcbiAgICAgICAgICBzdGF0aWNDbGFzczogJ3YtY2FsZW5kYXItd2Vla2x5X19oZWFkLXdlZWtudW1iZXInLFxuICAgICAgICB9KSlcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGhlYWRlclxuICAgIH0sXG4gICAgZ2VuSGVhZERheSAoZGF5OiBDYWxlbmRhclRpbWVzdGFtcCwgaW5kZXg6IG51bWJlcik6IFZOb2RlIHtcbiAgICAgIGNvbnN0IG91dHNpZGUgPSB0aGlzLmlzT3V0c2lkZSh0aGlzLmRheXNbaW5kZXhdKVxuICAgICAgY29uc3QgY29sb3IgPSBkYXkucHJlc2VudCA/IHRoaXMuY29sb3IgOiB1bmRlZmluZWRcblxuICAgICAgcmV0dXJuIHRoaXMuJGNyZWF0ZUVsZW1lbnQoJ2RpdicsIHRoaXMuc2V0VGV4dENvbG9yKGNvbG9yLCB7XG4gICAgICAgIGtleTogZGF5LmRhdGUsXG4gICAgICAgIHN0YXRpY0NsYXNzOiAndi1jYWxlbmRhci13ZWVrbHlfX2hlYWQtd2Vla2RheScsXG4gICAgICAgIGNsYXNzOiB0aGlzLmdldFJlbGF0aXZlQ2xhc3NlcyhkYXksIG91dHNpZGUpLFxuICAgICAgfSksIHRoaXMud2Vla2RheUZvcm1hdHRlcihkYXksIHRoaXMuc2hvcnRXZWVrZGF5cykpXG4gICAgfSxcbiAgICBnZW5XZWVrcyAoKTogVk5vZGVbXSB7XG4gICAgICBjb25zdCBkYXlzID0gdGhpcy5kYXlzXG4gICAgICBjb25zdCB3ZWVrRGF5cyA9IHRoaXMucGFyc2VkV2Vla2RheXMubGVuZ3RoXG4gICAgICBjb25zdCB3ZWVrczogVk5vZGVbXSA9IFtdXG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF5cy5sZW5ndGg7IGkgKz0gd2Vla0RheXMpIHtcbiAgICAgICAgd2Vla3MucHVzaCh0aGlzLmdlbldlZWsoZGF5cy5zbGljZShpLCBpICsgd2Vla0RheXMpLCB0aGlzLmdldFdlZWtOdW1iZXIoZGF5c1tpXSkpKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gd2Vla3NcbiAgICB9LFxuICAgIGdlbldlZWsgKHdlZWs6IENhbGVuZGFyVGltZXN0YW1wW10sIHdlZWtOdW1iZXI6IG51bWJlcik6IFZOb2RlIHtcbiAgICAgIGNvbnN0IHdlZWtOb2RlcyA9IHdlZWsubWFwKChkYXksIGluZGV4KSA9PiB0aGlzLmdlbkRheShkYXksIGluZGV4LCB3ZWVrKSlcblxuICAgICAgaWYgKHRoaXMuc2hvd1dlZWspIHtcbiAgICAgICAgd2Vla05vZGVzLnVuc2hpZnQodGhpcy5nZW5XZWVrTnVtYmVyKHdlZWtOdW1iZXIpKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy4kY3JlYXRlRWxlbWVudCgnZGl2Jywge1xuICAgICAgICBrZXk6IHdlZWtbMF0uZGF0ZSxcbiAgICAgICAgc3RhdGljQ2xhc3M6ICd2LWNhbGVuZGFyLXdlZWtseV9fd2VlaycsXG4gICAgICB9LCB3ZWVrTm9kZXMpXG4gICAgfSxcbiAgICBnZXRXZWVrTnVtYmVyIChkZXRlcm1pbmVEYXk6IENhbGVuZGFyVGltZXN0YW1wKSB7XG4gICAgICByZXR1cm4gd2Vla051bWJlcihcbiAgICAgICAgZGV0ZXJtaW5lRGF5LnllYXIsXG4gICAgICAgIGRldGVybWluZURheS5tb250aCAtIDEsXG4gICAgICAgIGRldGVybWluZURheS5kYXksXG4gICAgICAgIHRoaXMucGFyc2VkV2Vla2RheXNbMF0sXG4gICAgICAgIHBhcnNlSW50KHRoaXMubG9jYWxlRmlyc3REYXlPZlllYXIpXG4gICAgICApXG4gICAgfSxcbiAgICBnZW5XZWVrTnVtYmVyICh3ZWVrTnVtYmVyOiBudW1iZXIpIHtcbiAgICAgIHJldHVybiB0aGlzLiRjcmVhdGVFbGVtZW50KCdkaXYnLCB7XG4gICAgICAgIHN0YXRpY0NsYXNzOiAndi1jYWxlbmRhci13ZWVrbHlfX3dlZWtudW1iZXInLFxuICAgICAgfSwgW1xuICAgICAgICB0aGlzLiRjcmVhdGVFbGVtZW50KCdzbWFsbCcsIFN0cmluZyh3ZWVrTnVtYmVyKSksXG4gICAgICBdKVxuICAgIH0sXG4gICAgZ2VuRGF5IChkYXk6IENhbGVuZGFyVGltZXN0YW1wLCBpbmRleDogbnVtYmVyLCB3ZWVrOiBDYWxlbmRhclRpbWVzdGFtcFtdKTogVk5vZGUge1xuICAgICAgY29uc3Qgb3V0c2lkZSA9IHRoaXMuaXNPdXRzaWRlKGRheSlcblxuICAgICAgcmV0dXJuIHRoaXMuJGNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtcbiAgICAgICAga2V5OiBkYXkuZGF0ZSxcbiAgICAgICAgc3RhdGljQ2xhc3M6ICd2LWNhbGVuZGFyLXdlZWtseV9fZGF5JyxcbiAgICAgICAgY2xhc3M6IHRoaXMuZ2V0UmVsYXRpdmVDbGFzc2VzKGRheSwgb3V0c2lkZSksXG4gICAgICAgIG9uOiB0aGlzLmdldERlZmF1bHRNb3VzZUV2ZW50SGFuZGxlcnMoJzpkYXknLCBuYXRpdmVFdmVudCA9PiB7XG4gICAgICAgICAgcmV0dXJuIHsgbmF0aXZlRXZlbnQsIC4uLmRheSB9XG4gICAgICAgIH0pLFxuICAgICAgfSwgW1xuICAgICAgICB0aGlzLmdlbkRheUxhYmVsKGRheSksXG4gICAgICAgIC4uLihnZXRTbG90KHRoaXMsICdkYXknLCAoKSA9PiAoeyBvdXRzaWRlLCBpbmRleCwgd2VlaywgLi4uZGF5IH0pKSB8fCBbXSksXG4gICAgICBdKVxuICAgIH0sXG4gICAgZ2VuRGF5TGFiZWwgKGRheTogQ2FsZW5kYXJUaW1lc3RhbXApOiBWTm9kZSB7XG4gICAgICByZXR1cm4gdGhpcy4kY3JlYXRlRWxlbWVudCgnZGl2Jywge1xuICAgICAgICBzdGF0aWNDbGFzczogJ3YtY2FsZW5kYXItd2Vla2x5X19kYXktbGFiZWwnLFxuICAgICAgfSwgZ2V0U2xvdCh0aGlzLCAnZGF5LWxhYmVsJywgZGF5KSB8fCBbdGhpcy5nZW5EYXlMYWJlbEJ1dHRvbihkYXkpXSlcbiAgICB9LFxuICAgIGdlbkRheUxhYmVsQnV0dG9uIChkYXk6IENhbGVuZGFyVGltZXN0YW1wKTogVk5vZGUge1xuICAgICAgY29uc3QgY29sb3IgPSBkYXkucHJlc2VudCA/IHRoaXMuY29sb3IgOiAndHJhbnNwYXJlbnQnXG4gICAgICBjb25zdCBoYXNNb250aCA9IGRheS5kYXkgPT09IDEgJiYgdGhpcy5zaG93TW9udGhPbkZpcnN0XG5cbiAgICAgIHJldHVybiB0aGlzLiRjcmVhdGVFbGVtZW50KFZCdG4sIHtcbiAgICAgICAgcHJvcHM6IHtcbiAgICAgICAgICBjb2xvcixcbiAgICAgICAgICBmYWI6IHRydWUsXG4gICAgICAgICAgZGVwcmVzc2VkOiB0cnVlLFxuICAgICAgICAgIHNtYWxsOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgICBvbjogdGhpcy5nZXRNb3VzZUV2ZW50SGFuZGxlcnMoe1xuICAgICAgICAgICdjbGljazpkYXRlJzogeyBldmVudDogJ2NsaWNrJywgc3RvcDogdHJ1ZSB9LFxuICAgICAgICAgICdjb250ZXh0bWVudTpkYXRlJzogeyBldmVudDogJ2NvbnRleHRtZW51Jywgc3RvcDogdHJ1ZSwgcHJldmVudDogdHJ1ZSwgcmVzdWx0OiBmYWxzZSB9LFxuICAgICAgICB9LCBuYXRpdmVFdmVudCA9PiAoeyBuYXRpdmVFdmVudCwgLi4uZGF5IH0pKSxcbiAgICAgIH0sIGhhc01vbnRoXG4gICAgICAgID8gdGhpcy5tb250aEZvcm1hdHRlcihkYXksIHRoaXMuc2hvcnRNb250aHMpICsgJyAnICsgdGhpcy5kYXlGb3JtYXR0ZXIoZGF5LCBmYWxzZSlcbiAgICAgICAgOiB0aGlzLmRheUZvcm1hdHRlcihkYXksIGZhbHNlKVxuICAgICAgKVxuICAgIH0sXG4gICAgZ2VuRGF5TW9udGggKGRheTogQ2FsZW5kYXJUaW1lc3RhbXApOiBWTm9kZSB8IHN0cmluZyB7XG4gICAgICBjb25zdCBjb2xvciA9IGRheS5wcmVzZW50ID8gdGhpcy5jb2xvciA6IHVuZGVmaW5lZFxuXG4gICAgICByZXR1cm4gdGhpcy4kY3JlYXRlRWxlbWVudCgnZGl2JywgdGhpcy5zZXRUZXh0Q29sb3IoY29sb3IsIHtcbiAgICAgICAgc3RhdGljQ2xhc3M6ICd2LWNhbGVuZGFyLXdlZWtseV9fZGF5LW1vbnRoJyxcbiAgICAgIH0pLCBnZXRTbG90KHRoaXMsICdkYXktbW9udGgnLCBkYXkpIHx8IHRoaXMubW9udGhGb3JtYXR0ZXIoZGF5LCB0aGlzLnNob3J0TW9udGhzKSlcbiAgICB9LFxuICB9LFxuXG4gIHJlbmRlciAoaCk6IFZOb2RlIHtcbiAgICByZXR1cm4gaCgnZGl2Jywge1xuICAgICAgc3RhdGljQ2xhc3M6IHRoaXMuc3RhdGljQ2xhc3MsXG4gICAgICBjbGFzczogdGhpcy5jbGFzc2VzLFxuICAgICAgb246IHtcbiAgICAgICAgZHJhZ3N0YXJ0OiAoZTogTW91c2VFdmVudCkgPT4ge1xuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LCBbXG4gICAgICAhdGhpcy5oaWRlSGVhZGVyID8gdGhpcy5nZW5IZWFkKCkgOiAnJyxcbiAgICAgIC4uLnRoaXMuZ2VuV2Vla3MoKSxcbiAgICBdKVxuICB9LFxufSlcbiJdfQ==