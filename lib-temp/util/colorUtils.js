// Utilities
import { consoleWarn } from './console';
import { chunk, padEnd } from './helpers';
import { toXYZ } from './color/transformSRGB';
export function isCssColor(color) {
    return !!color && !!color.match(/^(#|var\(--|(rgb|hsl)a?\()/);
}
export function colorToInt(color) {
    let rgb;
    if (typeof color === 'number') {
        rgb = color;
    }
    else if (typeof color === 'string') {
        let c = color[0] === '#' ? color.substring(1) : color;
        if (c.length === 3) {
            c = c.split('').map(char => char + char).join('');
        }
        if (c.length !== 6) {
            consoleWarn(`'${color}' is not a valid rgb color`);
        }
        rgb = parseInt(c, 16);
    }
    else {
        throw new TypeError(`Colors can only be numbers or strings, recieved ${color == null ? color : color.constructor.name} instead`);
    }
    if (rgb < 0) {
        consoleWarn(`Colors cannot be negative: '${color}'`);
        rgb = 0;
    }
    else if (rgb > 0xffffff || isNaN(rgb)) {
        consoleWarn(`'${color}' is not a valid rgb color`);
        rgb = 0xffffff;
    }
    return rgb;
}
export function classToHex(color, colors, currentTheme) {
    const [colorName, colorModifier] = color
        .toString().trim().replace('-', '').split(' ', 2);
    let hexColor = '';
    if (colorName && colorName in colors) {
        if (colorModifier && colorModifier in colors[colorName]) {
            hexColor = colors[colorName][colorModifier];
        }
        else if ('base' in colors[colorName]) {
            hexColor = colors[colorName].base;
        }
    }
    else if (colorName && colorName in currentTheme) {
        hexColor = currentTheme[colorName];
    }
    return hexColor;
}
export function intToHex(color) {
    let hexColor = color.toString(16);
    if (hexColor.length < 6)
        hexColor = '0'.repeat(6 - hexColor.length) + hexColor;
    return '#' + hexColor;
}
export function colorToHex(color) {
    return intToHex(colorToInt(color));
}
/**
 * Converts HSVA to RGBA. Based on formula from https://en.wikipedia.org/wiki/HSL_and_HSV
 *
 * @param color HSVA color as an array [0-360, 0-1, 0-1, 0-1]
 */
export function HSVAtoRGBA(hsva) {
    const { h, s, v, a } = hsva;
    const f = (n) => {
        const k = (n + (h / 60)) % 6;
        return v - v * s * Math.max(Math.min(k, 4 - k, 1), 0);
    };
    const rgb = [f(5), f(3), f(1)].map(v => Math.round(v * 255));
    return { r: rgb[0], g: rgb[1], b: rgb[2], a };
}
/**
 * Converts RGBA to HSVA. Based on formula from https://en.wikipedia.org/wiki/HSL_and_HSV
 *
 * @param color RGBA color as an array [0-255, 0-255, 0-255, 0-1]
 */
export function RGBAtoHSVA(rgba) {
    if (!rgba)
        return { h: 0, s: 1, v: 1, a: 1 };
    const r = rgba.r / 255;
    const g = rgba.g / 255;
    const b = rgba.b / 255;
    const max = Math.max(r, g, b);
    const min = Math.min(r, g, b);
    let h = 0;
    if (max !== min) {
        if (max === r) {
            h = 60 * (0 + ((g - b) / (max - min)));
        }
        else if (max === g) {
            h = 60 * (2 + ((b - r) / (max - min)));
        }
        else if (max === b) {
            h = 60 * (4 + ((r - g) / (max - min)));
        }
    }
    if (h < 0)
        h = h + 360;
    const s = max === 0 ? 0 : (max - min) / max;
    const hsv = [h, s, max];
    return { h: hsv[0], s: hsv[1], v: hsv[2], a: rgba.a };
}
export function HSVAtoHSLA(hsva) {
    const { h, s, v, a } = hsva;
    const l = v - (v * s / 2);
    const sprime = l === 1 || l === 0 ? 0 : (v - l) / Math.min(l, 1 - l);
    return { h, s: sprime, l, a };
}
export function HSLAtoHSVA(hsl) {
    const { h, s, l, a } = hsl;
    const v = l + s * Math.min(l, 1 - l);
    const sprime = v === 0 ? 0 : 2 - (2 * l / v);
    return { h, s: sprime, v, a };
}
export function RGBAtoCSS(rgba) {
    return `rgba(${rgba.r}, ${rgba.g}, ${rgba.b}, ${rgba.a})`;
}
export function RGBtoCSS(rgba) {
    return RGBAtoCSS({ ...rgba, a: 1 });
}
export function RGBAtoHex(rgba) {
    const toHex = (v) => {
        const h = Math.round(v).toString(16);
        return ('00'.substr(0, 2 - h.length) + h).toUpperCase();
    };
    return `#${[
        toHex(rgba.r),
        toHex(rgba.g),
        toHex(rgba.b),
        toHex(Math.round(rgba.a * 255)),
    ].join('')}`;
}
export function HexToRGBA(hex) {
    const rgba = chunk(hex.slice(1), 2).map((c) => parseInt(c, 16));
    return {
        r: rgba[0],
        g: rgba[1],
        b: rgba[2],
        a: Math.round((rgba[3] / 255) * 100) / 100,
    };
}
export function HexToHSVA(hex) {
    const rgb = HexToRGBA(hex);
    return RGBAtoHSVA(rgb);
}
export function HSVAtoHex(hsva) {
    return RGBAtoHex(HSVAtoRGBA(hsva));
}
export function parseHex(hex) {
    if (hex.startsWith('#')) {
        hex = hex.slice(1);
    }
    hex = hex.replace(/([^0-9a-f])/gi, 'F');
    if (hex.length === 3 || hex.length === 4) {
        hex = hex.split('').map(x => x + x).join('');
    }
    if (hex.length === 6) {
        hex = padEnd(hex, 8, 'F');
    }
    else {
        hex = padEnd(padEnd(hex, 6), 8, 'F');
    }
    return `#${hex}`.toUpperCase().substr(0, 9);
}
export function parseGradient(gradient, colors, currentTheme) {
    return gradient.replace(/([a-z]+(\s[a-z]+-[1-5])?)(?=$|,)/gi, x => {
        return classToHex(x, colors, currentTheme) || x;
    }).replace(/(rgba\()#[0-9a-f]+(?=,)/gi, x => {
        return 'rgba(' + Object.values(HexToRGBA(parseHex(x.replace(/rgba\(/, '')))).slice(0, 3).join(',');
    });
}
export function RGBtoInt(rgba) {
    return (rgba.r << 16) + (rgba.g << 8) + rgba.b;
}
/**
 * Returns the contrast ratio (1-21) between two colors.
 *
 * @param c1 First color
 * @param c2 Second color
 */
export function contrastRatio(c1, c2) {
    const [, y1] = toXYZ(RGBtoInt(c1));
    const [, y2] = toXYZ(RGBtoInt(c2));
    return (Math.max(y1, y2) + 0.05) / (Math.min(y1, y2) + 0.05);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sb3JVdGlscy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsL2NvbG9yVXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWTtBQUNaLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxXQUFXLENBQUE7QUFDdkMsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxXQUFXLENBQUE7QUFDekMsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLHVCQUF1QixDQUFBO0FBa0I3QyxNQUFNLFVBQVUsVUFBVSxDQUFFLEtBQXNCO0lBQ2hELE9BQU8sQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyw0QkFBNEIsQ0FBQyxDQUFBO0FBQy9ELENBQUM7QUFFRCxNQUFNLFVBQVUsVUFBVSxDQUFFLEtBQVk7SUFDdEMsSUFBSSxHQUFHLENBQUE7SUFFUCxJQUFJLE9BQU8sS0FBSyxLQUFLLFFBQVEsRUFBRTtRQUM3QixHQUFHLEdBQUcsS0FBSyxDQUFBO0tBQ1o7U0FBTSxJQUFJLE9BQU8sS0FBSyxLQUFLLFFBQVEsRUFBRTtRQUNwQyxJQUFJLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUE7UUFDckQsSUFBSSxDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUNsQixDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFBO1NBQ2xEO1FBQ0QsSUFBSSxDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUNsQixXQUFXLENBQUMsSUFBSSxLQUFL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Q0FBQyxDQUFBO0lBQ3ZELENBQUMsQ0FBQTtJQUVELE1BQU0sR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFBO0lBRTVELE9BQU8sRUFBRSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQTtBQUMvQyxDQUFDO0FBRUQ7Ozs7R0FJRztBQUNILE1BQU0sVUFBVSxVQUFVLENBQUUsSUFBVTtJQUNwQyxJQUFJLENBQUMsSUFBSTtRQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUE7SUFFNUMsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUE7SUFDdEIsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUE7SUFDdEIsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUE7SUFDdEIsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO0lBQzdCLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtJQUU3QixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7SUFFVCxJQUFJLEdBQUcsS0FBSyxHQUFHLEVBQUU7UUFDZixJQUFJLEdBQUcsS0FBSyxDQUFDLEVBQUU7WUFDYixDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFBO1NBQ3ZDO2FBQU0sSUFBSSxHQUFHLEtBQUssQ0FBQyxFQUFFO1lBQ3BCLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUE7U0FDdkM7YUFBTSxJQUFJLEdBQUcsS0FBSyxDQUFDLEVBQUU7WUFDcEIsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQTtTQUN2QztLQUNGO0lBRUQsSUFBSSxDQUFDLEdBQUcsQ0FBQztRQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFBO0lBRXRCLE1BQU0sQ0FBQyxHQUFHLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFBO0lBQzNDLE1BQU0sR0FBRyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQTtJQUV2QixPQUFPLEVBQUUsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQTtBQUN2RCxDQUFDO0FBRUQsTUFBTSxVQUFVLFVBQVUsQ0FBRSxJQUFVO0lBQ3BDLE1BQU0sRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUE7SUFFM0IsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQTtJQUV6QixNQUFNLE1BQU0sR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBO0lBRXBFLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUE7QUFDL0IsQ0FBQztBQUVELE1BQU0sVUFBVSxVQUFVLENBQUUsR0FBUztJQUNuQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsR0FBRyxDQUFBO0lBRTFCLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBO0lBRXBDLE1BQU0sTUFBTSxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQTtJQUU1QyxPQUFPLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFBO0FBQy9CLENBQUM7QUFFRCxNQUFNLFVBQVUsU0FBUyxDQUFFLElBQVU7SUFDbkMsT0FBTyxRQUFRLElBQUksQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQTtBQUMzRCxDQUFDO0FBRUQsTUFBTSxVQUFVLFFBQVEsQ0FBRSxJQUFVO0lBQ2xDLE9BQU8sU0FBUyxDQUFDLEVBQUUsR0FBRyxJQUFJLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUE7QUFDckMsQ0FBQztBQUVELE1BQU0sVUFBVSxTQUFTLENBQUUsSUFBVTtJQUNuQyxNQUFNLEtBQUssR0FBRyxDQUFDLENBQVMsRUFBRSxFQUFFO1FBQzFCLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBQ3BDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFBO0lBQ3pELENBQUMsQ0FBQTtJQUVELE9BQU8sSUFBSTtRQUNULEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ2IsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDYixLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUNiLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7S0FDaEMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQTtBQUNkLENBQUM7QUFFRCxNQUFNLFVBQVUsU0FBUyxDQUFFLEdBQVE7SUFDakMsTUFBTSxJQUFJLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBUyxFQUFFLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUE7SUFFdkUsT0FBTztRQUNMLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ1YsQ0FBQyxFQUFFLElB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LENBQUMsQ0FBQyxDQUFBO0lBQ2xDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsQ0FBQyxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtJQUVsQyxPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQTtBQUM5RCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gVXRpbGl0aWVzXG5pbXBvcnQgeyBjb25zb2xlV2FybiB9IGZyb20gJy4vY29uc29sZSdcbmltcG9ydCB7IGNodW5rLCBwYWRFbmQgfSBmcm9tICcuL2hlbHBlcnMnXG5pbXBvcnQgeyB0b1hZWiB9IGZyb20gJy4vY29sb3IvdHJhbnNmb3JtU1JHQidcblxuLy8gVHlwZXNcbmltcG9ydCB7IFZ1ZXRpZnlUaGVtZVZhcmlhbnQgfSBmcm9tICd0eXBlcy9zZXJ2aWNlcy90aGVtZSdcblxuZXhwb3J0IHR5cGUgQ29sb3JJbnQgPSBudW1iZXJcbmV4cG9ydCB0eXBlIFhZWiA9IFtudW1iZXIsIG51bWJlciwgbnVtYmVyXVxuZXhwb3J0IHR5cGUgTEFCID0gW251bWJlciwgbnVtYmVyLCBudW1iZXJdXG5leHBvcnQgdHlwZSBIU1YgPSB7IGg6IG51bWJlciwgczogbnVtYmVyLCB2OiBudW1iZXIgfVxuZXhwb3J0IHR5cGUgSFNWQSA9IEhTViAmIHsgYTogbnVtYmVyIH1cbmV4cG9ydCB0eXBlIFJHQiA9IHsgcjogbnVtYmVyLCBnOiBudW1iZXIsIGI6IG51bWJlciB9XG5leHBvcnQgdHlwZSBSR0JBID0gUkdCICYgeyBhOiBudW1iZXIgfVxuZXhwb3J0IHR5cGUgSFNMID0geyBoOiBudW1iZXIsIHM6IG51bWJlciwgbDogbnVtYmVyIH1cbmV4cG9ydCB0eXBlIEhTTEEgPSBIU0wgJiB7IGE6IG51bWJlciB9XG5leHBvcnQgdHlwZSBIZXggPSBzdHJpbmdcbmV4cG9ydCB0eXBlIEhleGEgPSBzdHJpbmdcbmV4cG9ydCB0eXBlIENvbG9yID0gc3RyaW5nIHwgbnVtYmVyIHwge31cblxuZXhwb3J0IGZ1bmN0aW9uIGlzQ3NzQ29sb3IgKGNvbG9yPzogc3RyaW5nIHwgZmFsc2UpOiBib29sZWFuIHtcbiAgcmV0dXJuICEhY29sb3IgJiYgISFjb2xvci5tYXRjaCgvXigjfHZhclxcKC0tfChyZ2J8aHNsKWE/XFwoKS8pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb2xvclRvSW50IChjb2xvcjogQ29sb3IpOiBDb2xvckludCB7XG4gIGxldCByZ2JcblxuICBpZiAodHlwZW9mIGNvbG9yID09PSAnbnVtYmVyJykge1xuICAgIHJnYiA9IGNvbG9yXG4gIH0gZWxzZSBpZiAodHlwZW9mIGNvbG9yID09PSAnc3RyaW5nJykge1xuICAgIGxldCBjID0gY29sb3JbMF0gPT09ICcjJyA/IGNvbG9yLnN1YnN0cmluZygxKSA6IGNvbG9yXG4gICAgaWYgKGMubGVuZ3RoID09PSAzKSB7XG4gICAgICBjID0gYy5zcGxpdCgnJykubWFwKGNoYXIgPT4gY2hhciArIGNoYXIpLmpvaW4oJycpXG4gICAgfVxuICAgIGlmIChjLmxlbmd0aCAhPT0gNikge1xuICAgICAgY29uc29sZVdhcm4oYCcke2NvbG9yfScgaXMgbm90IGEgdmFsaWQgcmdiIGNvbG9yYClcbiAgICB9XG4gICAgcmdiID0gcGFyc2VJbnQoYywgMTYpXG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihgQ29sb3JzIGNhbiBvbmx5IGJlIG51bWJlcnMgb3Igc3RyaW5ncywgcmVjaWV2ZWQgJHtjb2xvciA9PSBudWxsID8gY29sb3IgOiBjb2xvci5jb25zdHJ1Y3Rvci5uYW1lfSBpbnN0ZWFkYClcbiAgfVxuXG4gIGlmIChyZ2IgPCAwKSB7XG4gICAgY29uc29sZVdhcm4oYENvbG9ycyBjYW5ub3QgYmUgbmVnYXRpdmU6ICcke2NvbG9yfSdgKVxuICAgIHJnYiA9IDBcbiAgfSBlbHNlIGlmIChyZ2IgPiAweGZmZmZmZiB8fCBpc05hTihyZ2IpKSB7XG4gICAgY29uc29sZVdhcm4oYCcke2NvbG9yfScgaXMgbm90IGEgdmFsaWQgcmdiIGNvbG9yYClcbiAgICByZ2IgPSAweGZmZmZmZlxuICB9XG5cbiAgcmV0dXJuIHJnYlxufVxuXG5leHBvcnQgZnVuY3Rpb24gY2xhc3NUb0hleCAoXG4gIGNvbG9yOiBzdHJpbmcsXG4gIGNvbG9yczogUmVjb3JkPHN0cmluZywgUmVjb3JkPHN0cmluZywgc3RyaW5nPj4sXG4gIGN1cnJlbnRUaGVtZTogUGFydGlhbDxWdWV0aWZ5VGhlbWVWYXJpYW50Pixcbik6IHN0cmluZyB7XG4gIGNvbnN0IFtjb2xvck5hbWUsIGNvbG9yTW9kaWZpZXJdID0gY29sb3JcbiAgICAudG9TdHJpbmcoKS50cmltKCkucmVwbGFjZSgnLScsICcnKS5zcGxpdCgnICcsIDIpIGFzIChzdHJpbmcgfCB1bmRlZmluZWQpW11cblxuICBsZXQgaGV4Q29sb3IgPSAnJ1xuICBpZiAoY29sb3JOYW1lICYmIGNvbG9yTmFtZSBpbiBjb2xvcnMpIHtcbiAgICBpZiAoY29sb3JNb2RpZmllciAmJiBjb2xvck1vZGlmaWVyIGluIGNvbG9yc1tjb2xvck5hbWVdKSB7XG4gICAgICBoZXhDb2xvciA9IGNvbG9yc1tjb2xvck5hbWVdW2NvbG9yTW9kaWZpZXJdXG4gICAgfSBlbHNlIGlmICgnYmFzZScgaW4gY29sb3JzW2NvbG9yTmFtZV0pIHtcbiAgICAgIGhleENvbG9yID0gY29sb3JzW2NvbG9yTmFtZV0uYmFzZVxuICAgIH1cbiAgfSBlbHNlIGlmIChjb2xvck5hbWUgJiYgY29sb3JOYW1lIGluIGN1cnJlbnRUaGVtZSkge1xuICAgIGhleENvbG9yID0gY3VycmVudFRoZW1lW2NvbG9yTmFtZV0gYXMgc3RyaW5nXG4gIH1cblxuICByZXR1cm4gaGV4Q29sb3Jcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGludFRvSGV4IChjb2xvcjogQ29sb3JJbnQpOiBzdHJpbmcge1xuICBsZXQgaGV4Q29sb3I6IHN0cmluZyA9IGNvbG9yLnRvU3RyaW5nKDE2KVxuXG4gIGlmIChoZXhDb2xvci5sZW5ndGggPCA2KSBoZXhDb2xvciA9ICcwJy5yZXBlYXQoNiAtIGhleENvbG9yLmxlbmd0aCkgKyBoZXhDb2xvclxuXG4gIHJldHVybiAnIycgKyBoZXhDb2xvclxufVxuXG5leHBvcnQgZnVuY3Rpb24gY29sb3JUb0hleCAoY29sb3I6IENvbG9yKTogc3RyaW5nIHtcbiAgcmV0dXJuIGludFRvSGV4KGNvbG9yVG9JbnQoY29sb3IpKVxufVxuXG4vKipcbiAqIENvbnZlcnRzIEhTVkEgdG8gUkdCQS4gQmFzZWQgb24gZm9ybXVsYSBmcm9tIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0hTTF9hbmRfSFNWXG4gKlxuICogQHBhcmFtIGNvbG9yIEhTVkEgY29sb3IgYXMgYW4gYXJyYXkgWzAtMzYwLCAwLTEsIDAtMSwgMC0xXVxuICovXG5leHBvcnQgZnVuY3Rpb24gSFNWQXRvUkdCQSAoaHN2YTogSFNWQSk6IFJHQkEge1xuICBjb25zdCB7IGgsIHMsIHYsIGEgfSA9IGhzdmFcbiAgY29uc3QgZiA9IChuOiBudW1iZXIpID0+IHtcbiAgICBjb25zdCBrID0gKG4gKyAoaCAvIDYwKSkgJSA2XG4gICAgcmV0dXJuIHYgLSB2ICogcyAqIE1hdGgubWF4KE1hdGgubWluKGssIDQgLSBrLCAxKSwgMClcbiAgfVxuXG4gIGNvbnN0IHJnYiA9IFtmKDUpLCBmKDMpLCBmKDEpXS5tYXAodiA9PiBNYXRoLnJvdW5kKHYgKiAyNTUpKVxuXG4gIHJldHVybiB7IHI6IHJnYlswXSwgZzogcmdiWzFdLCBiOiByZ2JbMl0sIGEgfVxufVxuXG4vKipcbiAqIENvbnZlcnRzIFJHQkEgdG8gSFNWQS4gQmFzZWQgb24gZm9ybXVsYSBmcm9tIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0hTTF9hbmRfSFNWXG4gKlxuICogQHBhcmFtIGNvbG9yIFJHQkEgY29sb3IgYXMgYW4gYXJyYXkgWzAtMjU1LCAwLTI1NSwgMC0yNTUsIDAtMV1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIFJHQkF0b0hTVkEgKHJnYmE6IFJHQkEpOiBIU1ZBIHtcbiAgaWYgKCFyZ2JhKSByZXR1cm4geyBoOiAwLCBzOiAxLCB2OiAxLCBhOiAxIH1cblxuICBjb25zdCByID0gcmdiYS5yIC8gMjU1XG4gIGNvbnN0IGcgPSByZ2JhLmcgLyAyNTVcbiAgY29uc3QgYiA9IHJnYmEuYiAvIDI1NVxuICBjb25zdCBtYXggPSBNYXRoLm1heChyLCBnLCBiKVxuICBjb25zdCBtaW4gPSBNYXRoLm1pbihyLCBnLCBiKVxuXG4gIGxldCBoID0gMFxuXG4gIGlmIChtYXggIT09IG1pbikge1xuICAgIGlmIChtYXggPT09IHIpIHtcbiAgICAgIGggPSA2MCAqICgwICsgKChnIC0gYikgLyAobWF4IC0gbWluKSkpXG4gICAgfSBlbHNlIGlmIChtYXggPT09IGcpIHtcbiAgICAgIGggPSA2MCAqICgyICsgKChiIC0gcikgLyAobWF4IC0gbWluKSkpXG4gICAgfSBlbHNlIGlmIChtYXggPT09IGIpIHtcbiAgICAgIGggPSA2MCAqICg0ICsgKChyIC0gZykgLyAobWF4IC0gbWluKSkpXG4gICAgfVxuICB9XG5cbiAgaWYgKGggPCAwKSBoID0gaCArIDM2MFxuXG4gIGNvbnN0IHMgPSBtYXggPT09IDAgPyAwIDogKG1heCAtIG1pbikgLyBtYXhcbiAgY29uc3QgaHN2ID0gW2gsIHMsIG1heF1cblxuICByZXR1cm4geyBoOiBoc3ZbMF0sIHM6IGhzdlsxXSwgdjogaHN2WzJdLCBhOiByZ2JhLmEgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gSFNWQXRvSFNMQSAoaHN2YTogSFNWQSk6IEhTTEEge1xuICBjb25zdCB7IGgsIHMsIHYsIGEgfSA9IGhzdmFcblxuICBjb25zdCBsID0gdiAtICh2ICogcyAvIDIpXG5cbiAgY29uc3Qgc3ByaW1lID0gbCA9PT0gMSB8fCBsID09PSAwID8gMCA6ICh2IC0gbCkgLyBNYXRoLm1pbihsLCAxIC0gbClcblxuICByZXR1cm4geyBoLCBzOiBzcHJpbWUsIGwsIGEgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gSFNMQXRvSFNWQSAoaHNsOiBIU0xBKTogSFNWQSB7XG4gIGNvbnN0IHsgaCwgcywgbCwgYSB9ID0gaHNsXG5cbiAgY29uc3QgdiA9IGwgKyBzICogTWF0aC5taW4obCwgMSAtIGwpXG5cbiAgY29uc3Qgc3ByaW1lID0gdiA9PT0gMCA/IDAgOiAyIC0gKDIgKiBsIC8gdilcblxuICByZXR1cm4geyBoLCBzOiBzcHJpbWUsIHYsIGEgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gUkdCQXRvQ1NTIChyZ2JhOiBSR0JBKTogc3RyaW5nIHtcbiAgcmV0dXJuIGByZ2JhKCR7cmdiYS5yfSwgJHtyZ2JhLmd9LCAke3JnYmEuYn0sICR7cmdiYS5hfSlgXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBSR0J0b0NTUyAocmdiYTogUkdCQSk6IHN0cmluZyB7XG4gIHJldHVybiBSR0JBdG9DU1MoeyAuLi5yZ2JhLCBhOiAxIH0pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBSR0JBdG9IZXggKHJnYmE6IFJHQkEpOiBIZXgge1xuICBjb25zdCB0b0hleCA9ICh2OiBudW1iZXIpID0+IHtcbiAgICBjb25zdCBoID0gTWF0aC5yb3VuZCh2KS50b1N0cmluZygxNilcbiAgICByZXR1cm4gKCcwMCcuc3Vic3RyKDAsIDIgLSBoLmxlbmd0aCkgKyBoKS50b1VwcGVyQ2FzZSgpXG4gIH1cblxuICByZXR1cm4gYCMke1tcbiAgICB0b0hleChyZ2JhLnIpLFxuICAgIHRvSGV4KHJnYmEuZyksXG4gICAgdG9IZXgocmdiYS5iKSxcbiAgICB0b0hleChNYXRoLnJvdW5kKHJnYmEuYSAqIDI1NSkpLFxuICBdLmpvaW4oJycpfWBcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIEhleFRvUkdCQSAoaGV4OiBIZXgpOiBSR0JBIHtcbiAgY29uc3QgcmdiYSA9IGNodW5rKGhleC5zbGljZSgxKSwgMikubWFwKChjOiBzdHJpbmcpID0+IHBhcnNlSW50KGMsIDE2KSlcblxuICByZXR1cm4ge1xuICAgIHI6IHJnYmFbMF0sXG4gICAgZzogcmdiYVsxXSxcbiAgICBiOiByZ2JhWzJdLFxuICAgIGE6IE1hdGgucm91bmQoKHJnYmFbM10gLyAyNTUpICogMTAwKSAvIDEwMCxcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gSGV4VG9IU1ZBIChoZXg6IEhleCk6IEhTVkEge1xuICBjb25zdCByZ2IgPSBIZXhUb1JHQkEoaGV4KVxuICByZXR1cm4gUkdCQXRvSFNWQShyZ2IpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBIU1ZBdG9IZXggKGhzdmE6IEhTVkEpOiBIZXgge1xuICByZXR1cm4gUkdCQXRvSGV4KEhTVkF0b1JHQkEoaHN2YSkpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZUhleCAoaGV4OiBzdHJpbmcpOiBIZXgge1xuICBpZiAoaGV4LnN0YXJ0c1dpdGgoJyMnKSkge1xuICAgIGhleCA9IGhleC5zbGljZSgxKVxuICB9XG5cbiAgaGV4ID0gaGV4LnJlcGxhY2UoLyhbXjAtOWEtZl0pL2dpLCAnRicpXG5cbiAgaWYgKGhleC5sZW5ndGggPT09IDMgfHwgaGV4Lmxlbmd0aCA9PT0gNCkge1xuICAgIGhleCA9IGhleC5zcGxpdCgnJykubWFwKHggPT4geCArIHgpLmpvaW4oJycpXG4gIH1cblxuICBpZiAoaGV4Lmxlbmd0aCA9PT0gNikge1xuICAgIGhleCA9IHBhZEVuZChoZXgsIDgsICdGJylcbiAgfSBlbHNlIHtcbiAgICBoZXggPSBwYWRFbmQocGFkRW5kKGhleCwgNiksIDgsICdGJylcbiAgfVxuXG4gIHJldHVybiBgIyR7aGV4fWAudG9VcHBlckNhc2UoKS5zdWJzdHIoMCwgOSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlR3JhZGllbnQgKFxuICBncmFkaWVudDogc3RyaW5nLFxuICBjb2xvcnM6IFJlY29yZDxzdHJpbmcsIFJlY29yZDxzdHJpbmcsIHN0cmluZz4+LFxuICBjdXJyZW50VGhlbWU6IFBhcnRpYWw8VnVldGlmeVRoZW1lVmFyaWFudD4sXG4pIHtcbiAgcmV0dXJuIGdyYWRpZW50LnJlcGxhY2UoLyhbYS16XSsoXFxzW2Etel0rLVsxLTVdKT8pKD89JHwsKS9naSwgeCA9PiB7XG4gICAgcmV0dXJuIGNsYXNzVG9IZXgoeCwgY29sb3JzLCBjdXJyZW50VGhlbWUpIHx8IHhcbiAgfSkucmVwbGFjZSgvKHJnYmFcXCgpI1swLTlhLWZdKyg/PSwpL2dpLCB4ID0+IHtcbiAgICByZXR1cm4gJ3JnYmEoJyArIE9iamVjdC52YWx1ZXMoSGV4VG9SR0JBKHBhcnNlSGV4KHgucmVwbGFjZSgvcmdiYVxcKC8sICcnKSkpKS5zbGljZSgwLCAzKS5qb2luKCcsJylcbiAgfSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIFJHQnRvSW50IChyZ2JhOiBSR0JBKTogQ29sb3JJbnQge1xuICByZXR1cm4gKHJnYmEuciA8PCAxNikgKyAocmdiYS5nIDw8IDgpICsgcmdiYS5iXG59XG5cbi8qKlxuICogUmV0dXJucyB0aGUgY29udHJhc3QgcmF0aW8gKDEtMjEpIGJldHdlZW4gdHdvIGNvbG9ycy5cbiAqXG4gKiBAcGFyYW0gYzEgRmlyc3QgY29sb3JcbiAqIEBwYXJhbSBjMiBTZWNvbmQgY29sb3JcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNvbnRyYXN0UmF0aW8gKGMxOiBSR0JBLCBjMjogUkdCQSk6IG51bWJlciB7XG4gIGNvbnN0IFssIHkxXSA9IHRvWFlaKFJHQnRvSW50KGMxKSlcbiAgY29uc3QgWywgeTJdID0gdG9YWVooUkdCdG9JbnQoYzIpKVxuXG4gIHJldHVybiAoTWF0aC5tYXgoeTEsIHkyKSArIDAuMDUpIC8gKE1hdGgubWluKHkxLCB5MikgKyAwLjA1KVxufVxuIl19