import { keys } from '../../util/helpers';
import { colorToInt, intToHex, colorToHex } from '../../util/colorUtils';
import * as sRGB from '../../util/color/transformSRGB';
import * as LAB from '../../util/color/transformCIELAB';
export function parse(theme, isItem = false, variations = true) {
    const { anchor, ...variant } = theme;
    const colors = Object.keys(variant);
    const parsedTheme = {};
    for (let i = 0; i < colors.length; ++i) {
        const name = colors[i];
        const value = theme[name];
        if (value == null)
            continue;
        if (!variations) {
            parsedTheme[name] = { base: intToHex(colorToInt(value)) };
        }
        else if (isItem) {
            /* istanbul ignore else */
            if (name === 'base' || name.startsWith('lighten') || name.startsWith('darken')) {
                parsedTheme[name] = colorToHex(value);
            }
        }
        else if (typeof value === 'object') {
            parsedTheme[name] = parse(value, true, variations);
        }
        else {
            parsedTheme[name] = genVariations(name, colorToInt(value));
        }
    }
    if (!isItem) {
        parsedTheme.anchor = anchor || parsedTheme.base || parsedTheme.primary.base;
    }
    return parsedTheme;
}
/**
 * Generate the CSS for a base color (.primary)
 */
const genBaseColor = (name, value) => {
    return `
.v-application .${name} {
  background-color: ${value} !important;
  border-color: ${value} !important;
}
.v-application .${name}--text {
  color: ${value} !important;
  caret-color: ${value} !important;
}`;
};
/**
 * Generate the CSS for a variant color (.primary.darken-2)
 */
const genVariantColor = (name, variant, value) => {
    const [type, n] = variant.split(/(\d)/, 2);
    return `
.v-application .${name}.${type}-${n} {
  background-color: ${value} !important;
  border-color: ${value} !important;
}
.v-application .${name}--text.text--${type}-${n} {
  color: ${value} !important;
  caret-color: ${value} !important;
}`;
};
const genColorVariableName = (name, variant = 'base') => `--v-${name}-${variant}`;
const genColorVariable = (name, variant = 'base') => `var(${genColorVariableName(name, variant)})`;
export function genStyles(theme, cssVar = false) {
    const { anchor, ...variant } = theme;
    const colors = Object.keys(variant);
    if (!colors.length)
        return '';
    let variablesCss = '';
    let css = '';
    const aColor = cssVar ? genColorVariable('anchor') : anchor;
    css += `.v-application a { color: ${aColor}; }`;
    cssVar && (variablesCss += `  ${genColorVariableName('anchor')}: ${anchor};\n`);
    for (let i = 0; i < colors.length; ++i) {
        const name = colors[i];
        const value = theme[name];
        css += genBaseColor(name, cssVar ? genColorVariable(name) : value.base);
        cssVar && (variablesCss += `  ${genColorVariableName(name)}: ${value.base};\n`);
        const variants = keys(value);
        for (let i = 0; i < variants.length; ++i) {
            const variant = variants[i];
            const variantValue = value[variant];
            if (variant === 'base')
                continue;
            css += genVariantColor(name, variant, cssVar ? genColorVariable(name, variant) : variantValue);
            cssVar && (variablesCss += `  ${genColorVariableName(name, variant)}: ${variantValue};\n`);
        }
    }
    if (cssVar) {
        variablesCss = `:root {\n${variablesCss}}\n\n`;
    }
    return variablesCss + css;
}
export function genVariations(name, value) {
    const values = {
        base: intToHex(value),
    };
    for (let i = 5; i > 0; --i) {
        values[`lighten${i}`] = intToHex(lighten(value, i));
    }
    for (let i = 1; i <= 4; ++i) {
        values[`darken${i}`] = intToHex(darken(value, i));
    }
    return values;
}
export function lighten(value, amount) {
    const lab = LAB.fromXYZ(sRGB.toXYZ(value));
    lab[0] = lab[0] + amount * 10;
    return sRGB.fromXYZ(LAB.toXYZ(lab));
}
export function darken(value, amount) {
    const lab = LAB.fromXYZ(sRGB.toXYZ(value));
    lab[0] = lab[0] - amount * 10;
    return sRGB.fromXYZ(LAB.toXYZ(lab));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvc2VydmljZXMvdGhlbWUvdXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLG9CQUFvQixDQUFBO0FBQ3pDLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBWSxNQUFNLHVCQUF1QixDQUFBO0FBQ2xGLE9BQU8sS0FBSyxJQUFJLE1BQU0sZ0NBQWdDLENBQUE7QUFDdEQsT0FBTyxLQUFLLEdBQUcsTUFBTSxrQ0FBa0MsQ0FBQTtBQU12RCxNQUFNLFVBQVUsS0FBSyxDQUNuQixLQUF1QyxFQUN2QyxNQUFNLEdBQUcsS0FBSyxFQUNkLFVBQVUsR0FBRyxJQUFJO0lBRWpCLE1BQU0sRUFBRSxNQUFNLEVBQUUsR0FBRyxPQUFPLEVBQUUsR0FBRyxLQUFLLENBQUE7SUFDcEMsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQTtJQUNuQyxNQUFNLFdBQVcsR0FBUSxFQUFFLENBQUE7SUFFM0IsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLEVBQUU7UUFDdEMsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQ3RCLE1BQU0sS0FBSyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQUV6QixJQUFJLEtBQUssSUFBSSxJQUFJO1lBQUUsU0FBUTtRQUUzQixJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ2YsV0FBVyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLFFBQVEsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFBO1NBQzFEO2FBQU0sSUFBSSxNQUFNLEVBQUU7WUFDakIsMEJBQTBCO1lBQzFCLElBQUksSUFBSSxLQUFLLE1BQU0sSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLEVBQUU7Z0JBQzlFLFdBQVcsQ0FBQyxJQUFJLENBQUMsR0FBRyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUE7YUFDdEM7U0FDRjthQUFNLElBQUksT0FBTyxLQUFLLEtBQUssUUFBUSxFQUFFO1lBQ3BDLFdBQVcsQ0FBQyxJQUFJLENBQUMsR0FBRyxLQUFLLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxVQUFVLENBQUMsQ0FBQTtTQUNuRDthQUFNO1lBQ0wsV0FBVyxDQUFDLElBQUksQ0FBQyxHQUFHLGFBQWEsQ0FBQyxJQUFJLEVBQUUsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUE7U0FDM0Q7S0FDRjtJQUVELElBQUksQ0FBQyxNQUFNLEVBQUU7UUFDWCxXQUFXLENBQUMsTUFBTSxHQUFHLE1BQU0sSUFBSSxXQUFXLENBQUMsSUFBSSxJQUFJLFdBQVcsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFBO0tBQzVFO0lBRUQsT0FBTyxXQUFXLENBQUE7QUFDcEIsQ0FBQztBQUVEOztHQUVHO0FBQ0gsTUFBTSxZQUFZLEdBQUcsQ0FBQyxJQUFZLEVBQUUsS0FBYSxFQUFVLEVBQUU7SUFDM0QsT0FBTztrQkFDUyxJQUFJO3NCQUNBLEtBQUs7a0JBQ1QsS0FBSzs7a0JBRUwsSUFBSTtXQUNYLEtBQUs7aUJBQ0MsS0FBSztFQUNwQixDQUFBO0FBQ0YsQ0FBQyxDQUFBO0FBRUQ7O0dBRUc7QUFDSCxNQUFNLGVBQWUsR0FBRyxDQUFDLElBQVksRUFBRSxPQUFlLEVBQUUsS0FBYSxFQUFVLEVBQUU7SUFDL0UsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQTtJQUMxQyxPQUFPO2tCQUNTLElBQUksSUFBSSxJQUFJLElBQUksQ0FBQztzQkFDYixLQUFLO2tCQUNULEtBQUs7O2tCQUVMLElBQUksZ0JBQWdCLElBQUksSUFBSSxDQUFDO1dBQ3BDLEtBQUs7aUJBQ0MsS0FBSztFQUNwQixDQUFBO0FBQ0YsQ0FBQyxDQUFBO0FBRUQsTUFBTSxvQkFBb0IsR0FBRyxDQUFDLElBQVksRUFBRSxPQUFPLEdBQUcsTUFBTSxFQUFVLEVBQUUsQ0FBQyxPQUFPLElBQUksSUFBSSxPQUFPLEVBQUUsQ0FBQTtBQUVqRyxNQUFNLGdCQUFnQixHQUFHLENBQUMsSUFBWSxFQUFFLE9BQU8sR0FBRyxNQUFNLEVBQVUsRUFBRSxDQUFDLE9BQU8sb0JBQW9CLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUE7QUFFbEgsTUFBTSxVQUFVLFNBQVMsQ0FBRSxLQUF5QixFQUFFLE1BQU0sR0FBRyxLQUFLO0lBQ2xFLE1BQU0sRUFBRSxNQUFNLEVBQUUsR0FBRyxPQUFPLEVBQUUsR0FBRyxLQUFLLENBQUE7SUFDcEMsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQTtJQUVuQyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU07UUFBRSxPQUFPLEVBQUUsQ0FBQTtJQUU3QixJQUFJLFlBQVksR0FBRyxFQUFFLENBQUE7SUFDckIsSUFBSSxHQUFHLEdBQUcsRUFBRSxDQUFBO0lBRVosTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFBO0lBQzNELEdBQUcsSUFBSSw2QkFBNkIsTUFBTSxLQUFLLENBQUE7SUFDL0MsTUFBTSxJQUFJLENBQUMsWUFBWSxJQUFJLEtBQUssb0JBQW9CLENBQUMsUUFBUSxDQUFDLEtBQUssTUFBTSxLQUFLLENBQUMsQ0FBQTtJQUUvRSxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsRUFBRTtRQUN0QyxNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDdEIsTUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFBO1FBRXpCLEdBQUcsSUFBSSxZQUFZLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQUN2RSxNQUFNLElBQUksQ0FBQyxZQUFZLElBQUksS0FBSyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsS0FBSyxLQUFLLENBQUMsSUFBSSxLQUFLLENBQUMsQ0FBQTtRQUUvRSxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDNUIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLEVBQUU7WUFDeEMsTUFBTSxPQUFPLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFBO1lBQzNCLE1BQU0sWUFBWSxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQTtZQUNuQyxJQUFJLE9BQU8sS0FBSyxNQUFNO2dCQUFFLFNBQVE7WUFFaEMsR0FBRyxJQUFJLGVBQWUsQ0FBQyxJQUFJLEVBQUUsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQTtZQUM5RixNQUFNLElBQUksQ0FBQyxZQUFZLElBQUksS0FBSyxvQkFBb0IsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLEtBQUssWUFBWSxLQUFLLENBQUMsQ0FBQTtTQUMzRjtLQUNGO0lBRUQsSUFBSSxNQUFNLEVBQUU7UUFDVixZQUFZLEdBQUcsWUFBWSxZQUFZLE9BQU8sQ0FBQTtLQUMvQztJQUVELE9BQU8sWUFBWSxHQUFHLEdBQUcsQ0FBQTtBQUMzQixDQUFDO0FBRUQsTUFBTSxVQUFVLGFBQWEsQ0FBRSxJQUFZLEVBQUUsS0FBZTtJQUMxRCxNQUFNLE1BQU0sR0FBMkI7UUFDckMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxLQUFLLENBQUM7S0FDdEIsQ0FBQTtJQUVELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUU7UUFDMUIsTUFBTSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsR0FBRyxRQUFRLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFBO0tBQ3BEO0lBRUQsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBRTtRQUMzQixNQUFNLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUE7S0FDbEQ7SUFFRCxPQUFPLE1BQU0sQ0FBQTtBQUNmLENBQUM7QUFFRCxNQUFNLFVBQVUsT0FBTyxDQUFFLEtBQWUsRUFBRSxNQUFjO0lBQ3RELE1BQU0sR0FBRyxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFBO0lBQzFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsTUFBTSxHQUFHLEVBQUUsQ0FBQTtJQUM3QixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBO0FBQ3JDLENBQUM7QUFFRCxNQUFNLFVBQVUsTUFBTSxDQUFFLEtBQWUsRUFBRSxNQUFjO0lBQ3JELE1BQU0sR0FBRyxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFBO0lBQzFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsTUFBTSxHQUFHLEVBQUUsQ0FBQTtJQUM3QixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBO0FBQ3JDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBrZXlzIH0gZnJvbSAnLi4vLi4vdXRpbC9oZWxwZXJzJ1xuaW1wb3J0IHsgY29sb3JUb0ludCwgaW50VG9IZXgsIGNvbG9yVG9IZXgsIENvbG9ySW50IH0gZnJvbSAnLi4vLi4vdXRpbC9jb2xvclV0aWxzJ1xuaW1wb3J0ICogYXMgc1JHQiBmcm9tICcuLi8uLi91dGlsL2NvbG9yL3RyYW5zZm9ybVNSR0InXG5pbXBvcnQgKiBhcyBMQUIgZnJvbSAnLi4vLi4vdXRpbC9jb2xvci90cmFuc2Zvcm1DSUVMQUInXG5pbXBvcnQge1xuICBWdWV0aWZ5UGFyc2VkVGhlbWUsXG4gIFZ1ZXRpZnlUaGVtZUl0ZW0sXG59IGZyb20gJ3Z1ZXRpZnkvdHlwZXMvc2VydmljZXMvdGhlbWUnXG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZSAoXG4gIHRoZW1lOiBSZWNvcmQ8c3RyaW5nLCBWdWV0aWZ5VGhlbWVJdGVtPixcbiAgaXNJdGVtID0gZmFsc2UsXG4gIHZhcmlhdGlvbnMgPSB0cnVlLFxuKTogVnVldGlmeVBhcnNlZFRoZW1lIHtcbiAgY29uc3QgeyBhbmNob3IsIC4uLnZhcmlhbnQgfSA9IHRoZW1lXG4gIGNvbnN0IGNvbG9ycyA9IE9iamVjdC5rZXlzKHZhcmlhbnQpXG4gIGNvbnN0IHBhcnNlZFRoZW1lOiBhbnkgPSB7fVxuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgY29sb3JzLmxlbmd0aDsgKytpKSB7XG4gICAgY29uc3QgbmFtZSA9IGNvbG9yc1tpXVxuICAgIGNvbnN0IHZhbHVlID0gdGhlbWVbbmFtZV1cblxuICAgIGlmICh2YWx1ZSA9PSBudWxsKSBjb250aW51ZVxuXG4gICAgaWYgKCF2YXJpYXRpb25zKSB7XG4gICAgICBwYXJzZWRUaGVtZVtuYW1lXSA9IHsgYmFzZTogaW50VG9IZXgoY29sb3JUb0ludCh2YWx1ZSkpIH1cbiAgICB9IGVsc2UgaWYgKGlzSXRlbSkge1xuICAgICAgLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi9cbiAgICAgIGlmIChuYW1lID09PSAnYmFzZScgfHwgbmFtZS5zdGFydHNXaXRoKCdsaWdodGVuJykgfHwgbmFtZS5zdGFydHNXaXRoKCdkYXJrZW4nKSkge1xuICAgICAgICBwYXJzZWRUaGVtZVtuYW1lXSA9IGNvbG9yVG9IZXgodmFsdWUpXG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSB7XG4gICAgICBwYXJzZWRUaGVtZVtuYW1lXSA9IHBhcnNlKHZhbHVlLCB0cnVlLCB2YXJpYXRpb25zKVxuICAgIH0gZWxzZSB7XG4gICAgICBwYXJzZWRUaGVtZVtuYW1lXSA9IGdlblZhcmlhdGlvbnMobmFtZSwgY29sb3JUb0ludCh2YWx1ZSkpXG4gICAgfVxuICB9XG5cbiAgaWYgKCFpc0l0ZW0pIHtcbiAgICBwYXJzZWRUaGVtZS5hbmNob3IgPSBhbmNob3IgfHwgcGFyc2VkVGhlbWUuYmFzZSB8fCBwYXJzZWRUaGVtZS5wcmltYXJ5LmJhc2VcbiAgfVxuXG4gIHJldHVybiBwYXJzZWRUaGVtZVxufVxuXG4vKipcbiAqIEdlbmVyYXRlIHRoZSBDU1MgZm9yIGEgYmFzZSBjb2xvciAoLnByaW1hcnkpXG4gKi9cbmNvbnN0IGdlbkJhc2VDb2xvciA9IChuYW1lOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcpOiBzdHJpbmcgPT4ge1xuICByZXR1cm4gYFxuLnYtYXBwbGljYXRpb24gLiR7bmFtZX0ge1xuICBiYWNrZ3JvdW5kLWNvbG9yOiAke3ZhbHVlfSAhaW1wb3J0YW50O1xuICBib3JkZXItY29sb3I6ICR7dmFsdWV9ICFpbXBvcnRhbnQ7XG59XG4udi1hcHBsaWNhdGlvbiAuJHtuYW1lfS0tdGV4dCB7XG4gIGNvbG9yOiAke3ZhbHVlfSAhaW1wb3J0YW50O1xuICBjYXJldC1jb2xvcjogJHt2YWx1ZX0gIWltcG9ydGFudDtcbn1gXG59XG5cbi8qKlxuICogR2VuZXJhdGUgdGhlIENTUyBmb3IgYSB2YXJpYW50IGNvbG9yICgucHJpbWFyeS5kYXJrZW4tMilcbiAqL1xuY29uc3QgZ2VuVmFyaWFudENvbG9yID0gKG5hbWU6IHN0cmluZywgdmFyaWFudDogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgY29uc3QgW3R5cGUsIG5dID0gdmFyaWFudC5zcGxpdCgvKFxcZCkvLCAyKVxuICByZXR1cm4gYFxuLnYtYXBwbGljYXRpb24gLiR7bmFtZX0uJHt0eXBlfS0ke259IHtcbiAgYmFja2dyb3VuZC1jb2xvcjogJHt2YWx1ZX0gIWltcG9ydGFudDtcbiAgYm9yZGVyLWNvbG9yOiAke3ZhbHVlfSAhaW1wb3J0YW50O1xufVxuLnYtYXBwbGljYXRpb24gLiR7bmFtZX0tLXRleHQudGV4dC0tJHt0eXBlfS0ke259IHtcbiAgY29sb3I6ICR7dmFsdWV9ICFpbXBvcnRhbnQ7XG4gIGNhcmV0LWNvbG9yOiAke3ZhbHVlfSAhaW1wb3J0YW50O1xufWBcbn1cblxuY29uc3QgZ2VuQ29sb3JWYXJpYWJsZU5hbWUgPSAobmFtZTogc3RyaW5nLCB2YXJpYW50ID0gJ2Jhc2UnKTogc3RyaW5nID0+IGAtLXYtJHtuYW1lfS0ke3ZhcmlhbnR9YFxuXG5jb25zdCBnZW5Db2xvclZhcmlhYmxlID0gKG5hbWU6IHN0cmluZywgdmFyaWFudCA9ICdiYXNlJyk6IHN0cmluZyA9PiBgdmFyKCR7Z2VuQ29sb3JWYXJpYWJsZU5hbWUobmFtZSwgdmFyaWFudCl9KWBcblxuZXhwb3J0IGZ1bmN0aW9uIGdlblN0eWxlcyAodGhlbWU6IFZ1ZXRpZnlQYXJzZWRUaGVtZSwgY3NzVmFyID0gZmFsc2UpOiBzdHJpbmcge1xuICBjb25zdCB7IGFuY2hvciwgLi4udmFyaWFudCB9ID0gdGhlbWVcbiAgY29uc3QgY29sb3JzID0gT2JqZWN0LmtleXModmFyaWFudClcblxuICBpZiAoIWNvbG9ycy5sZW5ndGgpIHJldHVybiAnJ1xuXG4gIGxldCB2YXJpYWJsZXNDc3MgPSAnJ1xuICBsZXQgY3NzID0gJydcblxuICBjb25zdCBhQ29sb3IgPSBjc3NWYXIgPyBnZW5Db2xvclZhcmlhYmxlKCdhbmNob3InKSA6IGFuY2hvclxuICBjc3MgKz0gYC52LWFwcGxpY2F0aW9uIGEgeyBjb2xvcjogJHthQ29sb3J9OyB9YFxuICBjc3NWYXIgJiYgKHZhcmlhYmxlc0NzcyArPSBgICAke2dlbkNvbG9yVmFyaWFibGVOYW1lKCdhbmNob3InKX06ICR7YW5jaG9yfTtcXG5gKVxuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgY29sb3JzLmxlbmd0aDsgKytpKSB7XG4gICAgY29uc3QgbmFtZSA9IGNvbG9yc1tpXVxuICAgIGNvbnN0IHZhbHVlID0gdGhlbWVbbmFtZV1cblxuICAgIGNzcyArPSBnZW5CYXNlQ29sb3IobmFtZSwgY3NzVmFyID8gZ2VuQ29sb3JWYXJpYWJsZShuYW1lKSA6IHZhbHVlLmJhc2UpXG4gICAgY3NzVmFyICYmICh2YXJpYWJsZXNDc3MgKz0gYCAgJHtnZW5Db2xvclZhcmlhYmxlTmFtZShuYW1lKX06ICR7dmFsdWUuYmFzZX07XFxuYClcblxuICAgIGNvbnN0IHZhcmlhbnRzID0ga2V5cyh2YWx1ZSlcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZhcmlhbnRzLmxlbmd0aDsgKytpKSB7XG4gICAgICBjb25zdCB2YXJpYW50ID0gdmFyaWFudHNbaV1cbiAgICAgIGNvbnN0IHZhcmlhbnRWYWx1ZSA9IHZhbHVlW3ZhcmlhbnRdXG4gICAgICBpZiAodmFyaWFudCA9PT0gJ2Jhc2UnKSBjb250aW51ZVxuXG4gICAgICBjc3MgKz0gZ2VuVmFyaWFudENvbG9yKG5hbWUsIHZhcmlhbnQsIGNzc1ZhciA/IGdlbkNvbG9yVmFyaWFibGUobmFtZSwgdmFyaWFudCkgOiB2YXJpYW50VmFsdWUpXG4gICAgICBjc3NWYXIgJiYgKHZhcmlhYmxlc0NzcyArPSBgICAke2dlbkNvbG9yVmFyaWFibGVOYW1lKG5hbWUsIHZhcmlhbnQpfTogJHt2YXJpYW50VmFsdWV9O1xcbmApXG4gICAgfVxuICB9XG5cbiAgaWYgKGNzc1Zhcikge1xuICAgIHZhcmlhYmxlc0NzcyA9IGA6cm9vdCB7XFxuJHt2YXJpYWJsZXNDc3N9fVxcblxcbmBcbiAgfVxuXG4gIHJldHVybiB2YXJpYWJsZXNDc3MgKyBjc3Ncbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdlblZhcmlhdGlvbnMgKG5hbWU6IHN0cmluZywgdmFsdWU6IENvbG9ySW50KTogUmVjb3JkPHN0cmluZywgc3RyaW5nPiB7XG4gIGNvbnN0IHZhbHVlczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgICBiYXNlOiBpbnRUb0hleCh2YWx1ZSksXG4gIH1cblxuICBmb3IgKGxldCBpID0gNTsgaSA+IDA7IC0taSkge1xuICAgIHZhbHVlc1tgbGlnaHRlbiR7aX1gXSA9IGludFRvSGV4KGxpZ2h0ZW4odmFsdWUsIGkpKVxuICB9XG5cbiAgZm9yIChsZXQgaSA9IDE7IGkgPD0gNDsgKytpKSB7XG4gICAgdmFsdWVzW2BkYXJrZW4ke2l9YF0gPSBpbnRUb0hleChkYXJrZW4odmFsdWUsIGkpKVxuICB9XG5cbiAgcmV0dXJuIHZhbHVlc1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbGlnaHRlbiAodmFsdWU6IENvbG9ySW50LCBhbW91bnQ6IG51bWJlcik6IENvbG9ySW50IHtcbiAgY29uc3QgbGFiID0gTEFCLmZyb21YWVooc1JHQi50b1hZWih2YWx1ZSkpXG4gIGxhYlswXSA9IGxhYlswXSArIGFtb3VudCAqIDEwXG4gIHJldHVybiBzUkdCLmZyb21YWVooTEFCLnRvWFlaKGxhYikpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkYXJrZW4gKHZhbHVlOiBDb2xvckludCwgYW1vdW50OiBudW1iZXIpOiBDb2xvckludCB7XG4gIGNvbnN0IGxhYiA9IExBQi5mcm9tWFlaKHNSR0IudG9YWVoodmFsdWUpKVxuICBsYWJbMF0gPSBsYWJbMF0gLSBhbW91bnQgKiAxMFxuICByZXR1cm4gc1JHQi5mcm9tWFlaKExBQi50b1hZWihsYWIpKVxufVxuIl19