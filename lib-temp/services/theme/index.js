/* eslint-disable no-multi-spaces */
// Extensions
import { Service } from '../service';
// Utilities
import * as ThemeUtils from './utils';
import { getNestedValue } from '../../util/helpers';
// Types
import Vue from 'vue';
export class Theme extends Service {
    constructor(preset) {
        super();
        this.disabled = false;
        this.isDark = null;
        this.unwatch = null;
        this.vueMeta = null;
        const { dark, disable, options, themes, } = preset[Theme.property];
        this.dark = Boolean(dark);
        this.defaults = this.themes = themes;
        this.options = options;
        if (disable) {
            this.disabled = true;
            return;
        }
        this.themes = {
            dark: this.fillVariant(themes.dark, true),
            light: this.fillVariant(themes.light, false),
        };
    }
    // When setting css, check for element and apply new values
    /* eslint-disable-next-line accessor-pairs */
    set css(val) {
        if (this.vueMeta) {
            if (this.isVueMeta23) {
                this.applyVueMeta23();
            }
            return;
        }
        this.checkOrCreateStyleElement() && (this.styleEl.innerHTML = val);
    }
    set dark(val) {
        const oldDark = this.isDark;
        this.isDark = val;
        // Only apply theme after dark
        // has already been set before
        oldDark != null && this.applyTheme();
    }
    get dark() {
        return Boolean(this.isDark);
    }
    // Apply current theme default
    // only called on client side
    applyTheme() {
        if (this.disabled)
            return this.clearCss();
        this.css = this.generatedStyles;
    }
    clearCss() {
        this.css = '';
    }
    // Initialize theme for SSR and SPA
    // Attach to ssrContext head or
    // apply new theme to document
    init(root, ssrContext) {
        if (this.disabled)
            return;
        /* istanbul ignore else */
        if (root.$meta) {
            this.initVueMeta(root);
        }
        else if (ssrContext) {
            this.initSSR(ssrContext);
        }
        this.initTheme(root);
    }
    // Allows for you to set target theme
    setTheme(theme, value) {
        this.themes[theme] = Object.assign(this.themes[theme], value);
        this.applyTheme();
    }
    // Reset theme defaults
    resetThemes() {
        this.themes.light = Object.assign({}, this.defaults.light);
        this.themes.dark = Object.assign({}, this.defaults.dark);
        this.applyTheme();
    }
    // Check for existence of style element
    checkOrCreateStyleElement() {
        this.styleEl = document.getElementById('vuetify-theme-stylesheet');
        /* istanbul ignore next */
        if (this.styleEl)
            return true;
        this.genStyleElement(); // If doesn't have it, create it
        return Boolean(this.styleEl);
    }
    fillVariant(theme = {}, dark) {
        const defaultTheme = this.themes[dark ? 'dark' : 'light'];
        return Object.assign({}, defaultTheme, theme);
    }
    // Generate the style element
    // if applicable
    genStyleElement() {
        /* istanbul ignore if */
        if (typeof document === 'undefined')
            return;
        /* istanbul ignore next */
        this.styleEl = document.createElement('style');
        this.styleEl.type = 'text/css';
        this.styleEl.id = 'vuetify-theme-stylesheet';
        if (this.options.cspNonce) {
            this.styleEl.setAttribute('nonce', this.options.cspNonce);
        }
        document.head.appendChild(this.styleEl);
    }
    initVueMeta(root) {
        this.vueMeta = root.$meta();
        if (this.isVueMeta23) {
            // vue-meta needs to apply after mounted()
            root.$nextTick(() => {
                this.applyVueMeta23();
            });
            return;
        }
        const metaKeyName = typeof this.vueMeta.getOptions === 'function' ? this.vueMeta.getOptions().keyName : 'metaInfo';
        const metaInfo = root.$options[metaKeyName] || {};
        root.$options[metaKeyName] = () => {
            metaInfo.style = metaInfo.style || [];
            const vuetifyStylesheet = metaInfo.style.find((s) => s.id === 'vuetify-theme-stylesheet');
            if (!vuetifyStylesheet) {
                metaInfo.style.push({
                    cssText: this.generatedStyles,
                    type: 'text/css',
                    id: 'vuetify-theme-stylesheet',
                    nonce: (this.options || {}).cspNonce,
                });
            }
            else {
                vuetifyStylesheet.cssText = this.generatedStyles;
            }
            return metaInfo;
        };
    }
    applyVueMeta23() {
        const { set } = this.vueMeta.addApp('vuetify');
        set({
            style: [{
                    cssText: this.generatedStyles,
                    type: 'text/css',
                    id: 'vuetify-theme-stylesheet',
                    nonce: this.options.cspNonce,
                }],
        });
    }
    initSSR(ssrContext) {
        // SSR
        const nonce = this.options.cspNonce ? ` nonce="${this.options.cspNonce}"` : '';
        ssrContext.head = ssrContext.head || '';
        ssrContext.head += `<style type="text/css" id="vuetify-theme-stylesheet"${nonce}>${this.generatedStyles}</style>`;
    }
    initTheme(root) {
        // Only watch for reactivity on client side
        if (typeof document === 'undefined')
            return;
        // If we get here somehow, ensure
        // existing instance is removed
        if (this.unwatch) {
            this.unwatch();
            this.unwatch = null;
        }
        // TODO: Update to use RFC if merged
        // https://github.com/vuejs/rfcs/blob/advanced-reactivity-api/active-rfcs/0000-advanced-reactivity-api.md
        root.$once('hook:created', () => {
            const obs = Vue.observable({ themes: this.themes });
            this.unwatch = root.$watch(() => obs.themes, () => this.applyTheme(), { deep: true });
        });
        this.applyTheme();
    }
    get currentTheme() {
        const target = this.dark ? 'dark' : 'light';
        return this.themes[target];
    }
    get generatedStyles() {
        const theme = this.parsedTheme;
        /* istanbul ignore next */
        const options = this.options || {};
        let css;
        if (options.themeCache != null) {
            css = options.themeCache.get(theme);
            /* istanbul ignore if */
            if (css != null)
                return css;
        }
        css = ThemeUtils.genStyles(theme, options.customProperties);
        if (options.minifyTheme != null) {
            css = options.minifyTheme(css);
        }
        if (options.themeCache != null) {
            options.themeCache.set(theme, css);
        }
        return css;
    }
    get parsedTheme() {
        return ThemeUtils.parse(this.currentTheme || {}, undefined, getNestedValue(this.options, ['variations'], true));
    }
    // Is using v2.3 of vue-meta
    // https://github.com/nuxt/vue-meta/releases/tag/v2.3.0
    get isVueMeta23() {
        return typeof this.vueMeta.addApp === 'function';
    }
}
Theme.property = 'theme';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvc2VydmljZXMvdGhlbWUvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsb0NBQW9DO0FBQ3BDLGFBQWE7QUFDYixPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sWUFBWSxDQUFBO0FBRXBDLFlBQVk7QUFDWixPQUFPLEtBQUssVUFBVSxNQUFNLFNBQVMsQ0FBQTtBQUNyQyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sb0JBQW9CLENBQUE7QUFFbkQsUUFBUTtBQUNSLE9BQU8sR0FBRyxNQUFNLEtBQUssQ0FBQTtBQVNyQixNQUFNLE9BQU8sS0FBTSxTQUFRLE9BQU87SUFtQmhDLFlBQWEsTUFBcUI7UUFDaEMsS0FBSyxFQUFFLENBQUE7UUFqQkYsYUFBUSxHQUFHLEtBQUssQ0FBQTtRQVVmLFdBQU0sR0FBRyxJQUFzQixDQUFBO1FBRS9CLFlBQU8sR0FBRyxJQUEyQixDQUFBO1FBRXJDLFlBQU8sR0FBRyxJQUFrQixDQUFBO1FBS2xDLE1BQU0sRUFDSixJQUFJLEVBQ0osT0FBTyxFQUNQLE9BQU8sRUFDUCxNQUFNLEdBQ1AsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFBO1FBRTFCLElBQUksQ0FBQyxJQUFJLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFBO1FBQ3pCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUE7UUFDcEMsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUE7UUFFdEIsSUFBSSxPQUFPLEVBQUU7WUFDWCxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQTtZQUVwQixPQUFNO1NBQ1A7UUFFRCxJQUFJLENBQUMsTUFBTSxHQUFHO1lBQ1osSUFBSSxFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7WUFDekMsS0FB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QUFXO1FBQ2IsT0FBTyxVQUFVLENBQUMsS0FBSyxDQUNyQixJQUFJLENBQUMsWUFBWSxJQUFJLEVBQUUsRUFDdkIsU0FBUyxFQUNULGNBQWMsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsWUFBWSxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQ25ELENBQUE7SUFDSCxDQUFDO0lBRUQsNEJBQTRCO0lBQzVCLHVEQUF1RDtJQUN2RCxJQUFZLFdBQVc7UUFDckIsT0FBTyxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxLQUFLLFVBQVUsQ0FBQTtJQUNsRCxDQUFDOztBQTVRTSxjQUFRLEdBQVksT0FBTyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgbm8tbXVsdGktc3BhY2VzICovXG4vLyBFeHRlbnNpb25zXG5pbXBvcnQgeyBTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZSdcblxuLy8gVXRpbGl0aWVzXG5pbXBvcnQgKiBhcyBUaGVtZVV0aWxzIGZyb20gJy4vdXRpbHMnXG5pbXBvcnQgeyBnZXROZXN0ZWRWYWx1ZSB9IGZyb20gJy4uLy4uL3V0aWwvaGVscGVycydcblxuLy8gVHlwZXNcbmltcG9ydCBWdWUgZnJvbSAndnVlJ1xuaW1wb3J0IHsgVnVldGlmeVByZXNldCB9IGZyb20gJ3Z1ZXRpZnkvdHlwZXMvc2VydmljZXMvcHJlc2V0cydcbmltcG9ydCB7XG4gIFZ1ZXRpZnlQYXJzZWRUaGVtZSxcbiAgVnVldGlmeVRoZW1lcyxcbiAgVnVldGlmeVRoZW1lVmFyaWFudCxcbiAgVGhlbWUgYXMgSVRoZW1lLFxufSBmcm9tICd2dWV0aWZ5L3R5cGVzL3NlcnZpY2VzL3RoZW1lJ1xuXG5leHBvcnQgY2xhc3MgVGhlbWUgZXh0ZW5kcyBTZXJ2aWNlIHtcbiAgc3RhdGljIHByb3BlcnR5OiAndGhlbWUnID0gJ3RoZW1lJ1xuXG4gIHB1YmxpYyBkaXNhYmxlZCA9IGZhbHNlXG5cbiAgcHVibGljIG9wdGlvbnM6IElUaGVtZVsnb3B0aW9ucyddXG5cbiAgcHVibGljIHN0eWxlRWw/OiBIVE1MU3R5bGVFbGVtZW50XG5cbiAgcHVibGljIHRoZW1lczogVnVldGlmeVRoZW1lc1xuXG4gIHB1YmxpYyBkZWZhdWx0czogVnVldGlmeVRoZW1lc1xuXG4gIHByaXZhdGUgaXNEYXJrID0gbnVsbCBhcyBib29sZWFuIHwgbnVsbFxuXG4gIHByaXZhdGUgdW53YXRjaCA9IG51bGwgYXMgKCgpID0+IHZvaWQpIHwgbnVsbFxuXG4gIHByaXZhdGUgdnVlTWV0YSA9IG51bGwgYXMgYW55IHwgbnVsbFxuXG4gIGNvbnN0cnVjdG9yIChwcmVzZXQ6IFZ1ZXRpZnlQcmVzZXQpIHtcbiAgICBzdXBlcigpXG5cbiAgICBjb25zdCB7XG4gICAgICBkYXJrLFxuICAgICAgZGlzYWJsZSxcbiAgICAgIG9wdGlvbnMsXG4gICAgICB0aGVtZXMsXG4gICAgfSA9IHByZXNldFtUaGVtZS5wcm9wZXJ0eV1cblxuICAgIHRoaXMuZGFyayA9IEJvb2xlYW4oZGFyaylcbiAgICB0aGlzLmRlZmF1bHRzID0gdGhpcy50aGVtZXMgPSB0aGVtZXNcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zXG5cbiAgICBpZiAoZGlzYWJsZSkge1xuICAgICAgdGhpcy5kaXNhYmxlZCA9IHRydWVcblxuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgdGhpcy50aGVtZXMgPSB7XG4gICAgICBkYXJrOiB0aGlzLmZpbGxWYXJpYW50KHRoZW1lcy5kYXJrLCB0cnVlKSxcbiAgICAgIGxpZ2h0OiB0aGlzLmZpbGxWYXJpYW50KHRoZW1lcy5saWdodCwgZmFsc2UpLFxuICAgIH1cbiAgfVxuXG4gIC8vIFdoZW4gc2V0dGluZyBjc3MsIGNoZWNrIGZvciBlbGVtZW50IGFuZCBhcHBseSBuZXcgdmFsdWVzXG4gIC8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBhY2Nlc3Nvci1wYWlycyAqL1xuICBzZXQgY3NzICh2YWw6IHN0cmluZykge1xuICAgIGlmICh0aGlzLnZ1ZU1ldGEpIHtcbiAgICAgIGlmICh0aGlzLmlzVnVlTWV0YTIzKSB7XG4gICAgICAgIHRoaXMuYXBwbHlWdWVNZXRhMjMoKVxuICAgICAgfVxuICAgICAgcmV0dXJuXG4gICAgfVxuICAgIHRoaXMuY2hlY2tPckNyZWF0ZVN0eWxlRWxlbWVudCgpICYmICh0aGlzLnN0eWxlRWwhLmlubmVySFRNTCA9IHZhbClcbiAgfVxuXG4gIHNldCBkYXJrICh2YWw6IGJvb2xlYW4pIHtcbiAgICBjb25zdCBvbGREYXJrID0gdGhpcy5pc0RhcmtcblxuICAgIHRoaXMuaXNEYXJrID0gdmFsXG4gICAgLy8gT25seSBhcHBseSB0aGVtZSBhZnRlciBkYXJrXG4gICAgLy8gaGFzIGFscmVhZHkgYmVlbiBzZXQgYmVmb3JlXG4gICAgb2xkRGFyayAhPSBudWxsICYmIHRoaXMuYXBwbHlUaGVtZSgpXG4gIH1cblxuICBnZXQgZGFyayAoKSB7XG4gICAgcmV0dXJuIEJvb2xlYW4odGhpcy5pc0RhcmspXG4gIH1cblxuICAvLyBBcHBseSBjdXJyZW50IHRoZW1lIGRlZmF1bHRcbiAgLy8gb25seSBjYWxsZWQgb24gY2xpZW50IHNpZGVcbiAgcHVibGljIGFwcGx5VGhlbWUgKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmRpc2FibGVkKSByZXR1cm4gdGhpcy5jbGVhckNzcygpXG5cbiAgICB0aGlzLmNzcyA9IHRoaXMuZ2VuZXJhdGVkU3R5bGVzXG4gIH1cblxuICBwdWJsaWMgY2xlYXJDc3MgKCk6IHZvaWQge1xuICAgIHRoaXMuY3NzID0gJydcbiAgfVxuXG4gIC8vIEluaXRpYWxpemUgdGhlbWUgZm9yIFNTUiBhbmQgU1BBXG4gIC8vIEF0dGFjaCB0byBzc3JDb250ZXh0IGhlYWQgb3JcbiAgLy8gYXBwbHkgbmV3IHRoZW1lIHRvIGRvY3VtZW50XG4gIHB1YmxpYyBpbml0IChyb290OiBWdWUsIHNzckNvbnRleHQ/OiBhbnkpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5kaXNhYmxlZCkgcmV0dXJuXG5cbiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAqL1xuICAgIGlmICgocm9vdCBhcyBhbnkpLiRtZXRhKSB7XG4gICAgICB0aGlzLmluaXRWdWVNZXRhKHJvb3QpXG4gICAgfSBlbHNlIGlmIChzc3JDb250ZXh0KSB7XG4gICAgICB0aGlzLmluaXRTU1Ioc3NyQ29udGV4dClcbiAgICB9XG5cbiAgICB0aGlzLmluaXRUaGVtZShyb290KVxuICB9XG5cbiAgLy8gQWxsb3dzIGZvciB5b3UgdG8gc2V0IHRhcmdldCB0aGVtZVxuICBwdWJsaWMgc2V0VGhlbWUgKHRoZW1lOiAnbGlnaHQnIHwgJ2RhcmsnLCB2YWx1ZTogb2JqZWN0KSB7XG4gICAgdGhpcy50aGVtZXNbdGhlbWVdID0gT2JqZWN0LmFzc2lnbih0aGlzLnRoZW1lc1t0aGVtZV0sIHZhbHVlKVxuICAgIHRoaXMuYXBwbHlUaGVtZSgpXG4gIH1cblxuICAvLyBSZXNldCB0aGVtZSBkZWZhdWx0c1xuICBwdWJsaWMgcmVzZXRUaGVtZXMgKCkge1xuICAgIHRoaXMudGhlbWVzLmxpZ2h0ID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5kZWZhdWx0cy5saWdodClcbiAgICB0aGlzLnRoZW1lcy5kYXJrID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5kZWZhdWx0cy5kYXJrKVxuICAgIHRoaXMuYXBwbHlUaGVtZSgpXG4gIH1cblxuICAvLyBDaGVjayBmb3IgZXhpc3RlbmNlIG9mIHN0eWxlIGVsZW1lbnRcbiAgcHJpdmF0ZSBjaGVja09yQ3JlYXRlU3R5bGVFbGVtZW50ICgpOiBib29sZWFuIHtcbiAgICB0aGlzLnN0eWxlRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndnVldGlmeS10aGVtZS1zdHlsZXNoZWV0JykgYXMgSFRNTFN0eWxlRWxlbWVudFxuXG4gICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbiAgICBpZiAodGhpcy5zdHlsZUVsKSByZXR1cm4gdHJ1ZVxuXG4gICAgdGhpcy5nZW5TdHlsZUVsZW1lbnQoKSAvLyBJZiBkb2Vzbid0IGhhdmUgaXQsIGNyZWF0ZSBpdFxuXG4gICAgcmV0dXJuIEJvb2xlYW4odGhpcy5zdHlsZUVsKVxuICB9XG5cbiAgcHJpdmF0ZSBmaWxsVmFyaWFudCAoXG4gICAgdGhlbWU6IFBhcnRpYWw8VnVldGlmeVRoZW1lVmFyaWFudD4gPSB7fSxcbiAgICBkYXJrOiBib29sZWFuXG4gICk6IFZ1ZXRpZnlUaGVtZVZhcmlhbnQge1xuICAgIGNvbnN0IGRlZmF1bHRUaGVtZSA9IHRoaXMudGhlbWVzW2RhcmsgPyAnZGFyaycgOiAnbGlnaHQnXVxuXG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sXG4gICAgICBkZWZhdWx0VGhlbWUsXG4gICAgICB0aGVtZVxuICAgIClcbiAgfVxuXG4gIC8vIEdlbmVyYXRlIHRoZSBzdHlsZSBlbGVtZW50XG4gIC8vIGlmIGFwcGxpY2FibGVcbiAgcHJpdmF0ZSBnZW5TdHlsZUVsZW1lbnQgKCk6IHZvaWQge1xuICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqL1xuICAgIGlmICh0eXBlb2YgZG9jdW1lbnQgPT09ICd1bmRlZmluZWQnKSByZXR1cm5cblxuICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG4gICAgdGhpcy5zdHlsZUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKVxuICAgIHRoaXMuc3R5bGVFbC50eXBlID0gJ3RleHQvY3NzJ1xuICAgIHRoaXMuc3R5bGVFbC5pZCA9ICd2dWV0aWZ5LXRoZW1lLXN0eWxlc2hlZXQnXG5cbiAgICBpZiAodGhpcy5vcHRpb25zLmNzcE5vbmNlKSB7XG4gICAgICB0aGlzLnN0eWxlRWwuc2V0QXR0cmlidXRlKCdub25jZScsIHRoaXMub3B0aW9ucy5jc3BOb25jZSlcbiAgICB9XG5cbiAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHRoaXMuc3R5bGVFbClcbiAgfVxuXG4gIHByaXZhdGUgaW5pdFZ1ZU1ldGEgKHJvb3Q6IGFueSkge1xuICAgIHRoaXMudnVlTWV0YSA9IHJvb3QuJG1ldGEoKVxuICAgIGlmICh0aGlzLmlzVnVlTWV0YTIzKSB7XG4gICAgICAvLyB2dWUtbWV0YSBuZWVkcyB0byBhcHBseSBhZnRlciBtb3VudGVkKClcbiAgICAgIHJvb3QuJG5leHRUaWNrKCgpID0+IHtcbiAgICAgICAgdGhpcy5hcHBseVZ1ZU1ldGEyMygpXG4gICAgICB9KVxuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgY29uc3QgbWV0YUtleU5hbWUgPSB0eXBlb2YgdGhpcy52dWVNZXRhLmdldE9wdGlvbnMgPT09ICdmdW5jdGlvbicgPyB0aGlzLnZ1ZU1ldGEuZ2V0T3B0aW9ucygpLmtleU5hbWUgOiAnbWV0YUluZm8nXG4gICAgY29uc3QgbWV0YUluZm8gPSByb290LiRvcHRpb25zW21ldGFLZXlOYW1lXSB8fCB7fVxuXG4gICAgcm9vdC4kb3B0aW9uc1ttZXRhS2V5TmFtZV0gPSAoKSA9PiB7XG4gICAgICBtZXRhSW5mby5zdHlsZSA9IG1ldGFJbmZvLnN0eWxlIHx8IFtdXG5cbiAgICAgIGNvbnN0IHZ1ZXRpZnlTdHlsZXNoZWV0ID0gbWV0YUluZm8uc3R5bGUuZmluZCgoczogYW55KSA9PiBzLmlkID09PSAndnVldGlmeS10aGVtZS1zdHlsZXNoZWV0JylcblxuICAgICAgaWYgKCF2dWV0aWZ5U3R5bGVzaGVldCkge1xuICAgICAgICBtZXRhSW5mby5zdHlsZS5wdXNoKHtcbiAgICAgICAgICBjc3NUZXh0OiB0aGlzLmdlbmVyYXRlZFN0eWxlcyxcbiAgICAgICAgICB0eXBlOiAndGV4dC9jc3MnLFxuICAgICAgICAgIGlkOiAndnVldGlmeS10aGVtZS1zdHlsZXNoZWV0JyxcbiAgICAgICAgICBub25jZTogKHRoaXMub3B0aW9ucyB8fCB7fSkuY3NwTm9uY2UsXG4gICAgICAgIH0pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2dWV0aWZ5U3R5bGVzaGVldC5jc3NUZXh0ID0gdGhpcy5nZW5lcmF0ZWRTdHlsZXNcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG1ldGFJbmZvXG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhcHBseVZ1ZU1ldGEyMyAoKSB7XG4gICAgY29uc3QgeyBzZXQgfSA9IHRoaXMudnVlTWV0YS5hZGRBcHAoJ3Z1ZXRpZnknKVxuXG4gICAgc2V0KHtcbiAgICAgIHN0eWxlOiBbe1xuICAgICAgICBjc3NUZXh0OiB0aGlzLmdlbmVyYXRlZFN0eWxlcyxcbiAgICAgICAgdHlwZTogJ3RleHQvY3NzJyxcbiAgICAgICAgaWQ6ICd2dWV0aWZ5LXRoZW1lLXN0eWxlc2hlZXQnLFxuICAgICAgICBub25jZTogdGhpcy5vcHRpb25zLmNzcE5vbmNlLFxuICAgICAgfV0sXG4gICAgfSlcbiAgfVxuXG4gIHByaXZhdGUgaW5pdFNTUiAoc3NyQ29udGV4dD86IGFueSkge1xuICAgIC8vIFNTUlxuICAgIGNvbnN0IG5vbmNlID0gdGhpcy5vcHRpb25zLmNzcE5vbmNlID8gYCBub25jZT1cIiR7dGhpcy5vcHRpb25zLmNzcE5vbmNlfVwiYCA6ICcnXG4gICAgc3NyQ29udGV4dC5oZWFkID0gc3NyQ29udGV4dC5oZWFkIHx8ICcnXG4gICAgc3NyQ29udGV4dC5oZWFkICs9IGA8c3R5bGUgdHlwZT1cInRleHQvY3NzXCIgaWQ9XCJ2dWV0aWZ5LXRoZW1lLXN0eWxlc2hlZXRcIiR7bm9uY2V9PiR7dGhpcy5nZW5lcmF0ZWRTdHlsZXN9PC9zdHlsZT5gXG4gIH1cblxuICBwcml2YXRlIGluaXRUaGVtZSAocm9vdDogVnVlKSB7XG4gICAgLy8gT25seSB3YXRjaCBmb3IgcmVhY3Rpdml0eSBvbiBjbGllbnQgc2lkZVxuICAgIGlmICh0eXBlb2YgZG9jdW1lbnQgPT09ICd1bmRlZmluZWQnKSByZXR1cm5cblxuICAgIC8vIElmIHdlIGdldCBoZXJlIHNvbWVob3csIGVuc3VyZVxuICAgIC8vIGV4aXN0aW5nIGluc3RhbmNlIGlzIHJlbW92ZWRcbiAgICBpZiAodGhpcy51bndhdGNoKSB7XG4gICAgICB0aGlzLnVud2F0Y2goKVxuICAgICAgdGhpcy51bndhdGNoID0gbnVsbFxuICAgIH1cblxuICAgIC8vIFRPRE86IFVwZGF0ZSB0byB1c2UgUkZDIGlmIG1lcmdlZFxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS92dWVqcy9yZmNzL2Jsb2IvYWR2YW5jZWQtcmVhY3Rpdml0eS1hcGkvYWN0aXZlLXJmY3MvMDAwMC1hZHZhbmNlZC1yZWFjdGl2aXR5LWFwaS5tZFxuICAgIHJvb3QuJG9uY2UoJ2hvb2s6Y3JlYXRlZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IG9icyA9IFZ1ZS5vYnNlcnZhYmxlKHsgdGhlbWVzOiB0aGlzLnRoZW1lcyB9KVxuICAgICAgdGhpcy51bndhdGNoID0gcm9vdC4kd2F0Y2goKCkgPT4gb2JzLnRoZW1lcywgKCkgPT4gdGhpcy5hcHBseVRoZW1lKCksIHsgZGVlcDogdHJ1ZSB9KVxuICAgIH0pXG4gICAgdGhpcy5hcHBseVRoZW1lKClcbiAgfVxuXG4gIGdldCBjdXJyZW50VGhlbWUgKCkge1xuICAgIGNvbnN0IHRhcmdldCA9IHRoaXMuZGFyayA/ICdkYXJrJyA6ICdsaWdodCdcblxuICAgIHJldHVybiB0aGlzLnRoZW1lc1t0YXJnZXRdXG4gIH1cblxuICBnZXQgZ2VuZXJhdGVkU3R5bGVzICgpOiBzdHJpbmcge1xuICAgIGNvbnN0IHRoZW1lID0gdGhpcy5wYXJzZWRUaGVtZVxuICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMub3B0aW9ucyB8fCB7fVxuICAgIGxldCBjc3NcblxuICAgIGlmIChvcHRpb25zLnRoZW1lQ2FjaGUgIT0gbnVsbCkge1xuICAgICAgY3NzID0gb3B0aW9ucy50aGVtZUNhY2hlLmdldCh0aGVtZSlcbiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqL1xuICAgICAgaWYgKGNzcyAhPSBudWxsKSByZXR1cm4gY3NzXG4gICAgfVxuXG4gICAgY3NzID0gVGhlbWVVdGlscy5nZW5TdHlsZXModGhlbWUsIG9wdGlvbnMuY3VzdG9tUHJvcGVydGllcylcblxuICAgIGlmIChvcHRpb25zLm1pbmlmeVRoZW1lICE9IG51bGwpIHtcbiAgICAgIGNzcyA9IG9wdGlvbnMubWluaWZ5VGhlbWUoY3NzKVxuICAgIH1cblxuICAgIGlmIChvcHRpb25zLnRoZW1lQ2FjaGUgIT0gbnVsbCkge1xuICAgICAgb3B0aW9ucy50aGVtZUNhY2hlLnNldCh0aGVtZSwgY3NzKVxuICAgIH1cblxuICAgIHJldHVybiBjc3NcbiAgfVxuXG4gIGdldCBwYXJzZWRUaGVtZSAoKTogVnVldGlmeVBhcnNlZFRoZW1lIHtcbiAgICByZXR1cm4gVGhlbWVVdGlscy5wYXJzZShcbiAgICAgIHRoaXMuY3VycmVudFRoZW1lIHx8IHt9LFxuICAgICAgdW5kZWZpbmVkLFxuICAgICAgZ2V0TmVzdGVkVmFsdWUodGhpcy5vcHRpb25zLCBbJ3ZhcmlhdGlvbnMnXSwgdHJ1ZSlcbiAgICApXG4gIH1cblxuICAvLyBJcyB1c2luZyB2Mi4zIG9mIHZ1ZS1tZXRhXG4gIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9udXh0L3Z1ZS1tZXRhL3JlbGVhc2VzL3RhZy92Mi4zLjBcbiAgcHJpdmF0ZSBnZXQgaXNWdWVNZXRhMjMgKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0eXBlb2YgdGhpcy52dWVNZXRhLmFkZEFwcCA9PT0gJ2Z1bmN0aW9uJ1xuICB9XG59XG4iXX0=