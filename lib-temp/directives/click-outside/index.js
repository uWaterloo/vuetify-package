import { attachedRoot } from '../../util/dom';
function defaultConditional() {
    return true;
}
function checkEvent(e, el, binding) {
    // The include element callbacks below can be expensive
    // so we should avoid calling them when we're not active.
    // Explicitly check for false to allow fallback compatibility
    // with non-toggleable components
    if (!e || checkIsActive(e, binding) === false)
        return false;
    // If we're clicking inside the shadowroot, then the app root doesn't get the same
    // level of introspection as to _what_ we're clicking. We want to check to see if
    // our target is the shadowroot parent container, and if it is, ignore.
    const root = attachedRoot(el);
    if (typeof ShadowRoot !== 'undefined' &&
        root instanceof ShadowRoot &&
        root.host === e.target)
        return false;
    // Check if additional elements were passed to be included in check
    // (click must be outside all included elements, if any)
    const elements = ((typeof binding.value === 'object' && binding.value.include) || (() => []))();
    // Add the root element for the component this directive was defined on
    elements.push(el);
    // Check if it's a click outside our elements, and then if our callback returns true.
    // Non-toggleable components should take action in their callback and return falsy.
    // Toggleable can return true if it wants to deactivate.
    // Note that, because we're in the capture phase, this callback will occur before
    // the bubbling click event on any outside elements.
    return !elements.some(el => el.contains(e.target));
}
function checkIsActive(e, binding) {
    const isActive = (typeof binding.value === 'object' && binding.value.closeConditional) || defaultConditional;
    return isActive(e);
}
function directive(e, el, binding, vnode) {
    const handler = typeof binding.value === 'function' ? binding.value : binding.value.handler;
    el._clickOutside.lastMousedownWasOutside && checkEvent(e, el, binding) && setTimeout(() => {
        checkIsActive(e, binding) && handler && handler(e);
    }, 0);
}
function handleShadow(el, callback) {
    const root = attachedRoot(el);
    callback(document);
    if (typeof ShadowRoot !== 'undefined' && root instanceof ShadowRoot) {
        callback(root);
    }
}
export const ClickOutside = {
    // [data-app] may not be found
    // if using bind, inserted makes
    // sure that the root element is
    // available, iOS does not support
    // clicks on body
    inserted(el, binding, vnode) {
        const onClick = (e) => directive(e, el, binding, vnode);
        const onMousedown = (e) => {
            el._clickOutside.lastMousedownWasOutside = checkEvent(e, el, binding);
        };
        handleShadow(el, (app) => {
            app.addEventListener('click', onClick, true);
            app.addEventListener('mousedown', onMousedown, true);
        });
        if (!el._clickOutside) {
            el._clickOutside = {
                lastMousedownWasOutside: true,
            };
        }
        el._clickOutside[vnode.context._uid] = {
            onClick,
            onMousedown,
        };
    },
    unbind(el, binding, vnode) {
        if (!el._clickOutside)
            return;
        handleShadow(el, (app) => {
            if (!app || !el._clickOutside?.[vnode.context._uid])
                return;
            const { onClick, onMousedown } = el._clickOutside[vnode.context._uid];
            app.removeEventListener('click', onClick, true);
            app.removeEventListener('mousedown', onMousedown, true);
        });
        delete el._clickOutside[vnode.context._uid];
    },
};
export default ClickOutside;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvZGlyZWN0aXZlcy9jbGljay1vdXRzaWRlL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQTtBQWM3QyxTQUFTLGtCQUFrQjtJQUN6QixPQUFPLElBQUksQ0FBQTtBQUNiLENBQUM7QUFFRCxTQUFTLFVBQVUsQ0FBRSxDQUFlLEVBQUUsRUFBZSxFQUFFLE9BQThCO0lBQ25GLHVEQUF1RDtJQUN2RCx5REFBeUQ7SUFDekQsNkRBQTZEO0lBQzdELGlDQUFpQztJQUNqQyxJQUFJLENBQUMsQ0FBQyxJQUFJLGFBQWEsQ0FBQyxDQUFDLEVBQUUsT0FBTyxDQUFDLEtBQUssS0FBSztRQUFFLE9BQU8sS0FBSyxDQUFBO0lBRTNELGtGQUFrRjtJQUNsRixpRkFBaUY7SUFDakYsdUVBQXVFO0lBQ3ZFLE1BQU0sSUFBSSxHQUFHLFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQTtJQUM3QixJQUNFLE9BQU8sVUFBVSxLQUFLLFdBQVc7UUFDakMsSUFBSSxZQUFZLFVBQVU7UUFDMUIsSUFBSSxDQUFDLElBQUksS0FBSyxDQUFDLENBQUMsTUFBTTtRQUN0QixPQUFPLEtBQUssQ0FBQTtJQUVkLG1FQUFtRTtJQUNuRSx3REFBd0Q7SUFDeEQsTUFBTSxRQUFRLEdBQUcsQ0FBQyxDQUFDLE9BQU8sT0FBTyxDQUFDLEtBQUssS0FBSyxRQUFRLElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQTtJQUMvRix1RUFBdUU7SUFDdkUsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQTtJQUVqQixxRkFBcUY7SUFDckYsbUZBQW1GO0lBQ25GLHdEQUF3RDtJQUN4RCxpRkFBaUY7SUFDakYsb0RBQW9EO0lBQ3BE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RUFBRSxDQUFDLEdBQWdCLEVBQUUsRUFBRTtZQUNwQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFBRSxDQUFDLEtBQUssQ0FBQyxPQUFRLENBQUMsSUFBSSxDQUFDO2dCQUFFLE9BQU07WUFFNUQsTUFBTSxFQUFFLE9BQU8sRUFBRSxXQUFXLEVBQUUsR0FBRyxFQUFFLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxPQUFRLENBQUMsSUFBSSxDQUFFLENBQUE7WUFFdkUsR0FBRyxDQUFDLG1CQUFtQixDQUFDLE9BQU8sRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUE7WUFDL0MsR0FBRyxDQUFDLG1CQUFtQixDQUFDLFdBQVcsRUFBRSxXQUFXLEVBQUUsSUFBSSxDQUFDLENBQUE7UUFDekQsQ0FBQyxDQUFDLENBQUE7UUFFRixPQUFPLEVBQUUsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLE9BQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUM5QyxDQUFDO0NBQ0YsQ0FBQTtBQUVELGVBQWUsWUFBWSxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYXR0YWNoZWRSb290IH0gZnJvbSAnLi4vLi4vdXRpbC9kb20nXG5pbXBvcnQgeyBWTm9kZURpcmVjdGl2ZSB9IGZyb20gJ3Z1ZS90eXBlcy92bm9kZSdcbmltcG9ydCB7IFZOb2RlIH0gZnJvbSAndnVlJ1xuXG5pbnRlcmZhY2UgQ2xpY2tPdXRzaWRlQmluZGluZ0FyZ3Mge1xuICBoYW5kbGVyOiAoZTogRXZlbnQpID0+IHZvaWRcbiAgY2xvc2VDb25kaXRpb25hbD86IChlOiBFdmVudCkgPT4gYm9vbGVhblxuICBpbmNsdWRlPzogKCkgPT4gSFRNTEVsZW1lbnRbXVxufVxuXG5pbnRlcmZhY2UgQ2xpY2tPdXRzaWRlRGlyZWN0aXZlIGV4dGVuZHMgVk5vZGVEaXJlY3RpdmUge1xuICB2YWx1ZT86ICgoZTogRXZlbnQpID0+IHZvaWQpIHwgQ2xpY2tPdXRzaWRlQmluZGluZ0FyZ3Ncbn1cblxuZnVuY3Rpb24gZGVmYXVsdENvbmRpdGlvbmFsICgpIHtcbiAgcmV0dXJuIHRydWVcbn1cblxuZnVuY3Rpb24gY2hlY2tFdmVudCAoZTogUG9pbnRlckV2ZW50LCBlbDogSFRNTEVsZW1lbnQsIGJpbmRpbmc6IENsaWNrT3V0c2lkZURpcmVjdGl2ZSk6IGJvb2xlYW4ge1xuICAvLyBUaGUgaW5jbHVkZSBlbGVtZW50IGNhbGxiYWNrcyBiZWxvdyBjYW4gYmUgZXhwZW5zaXZlXG4gIC8vIHNvIHdlIHNob3VsZCBhdm9pZCBjYWxsaW5nIHRoZW0gd2hlbiB3ZSdyZSBub3QgYWN0aXZlLlxuICAvLyBFeHBsaWNpdGx5IGNoZWNrIGZvciBmYWxzZSB0byBhbGxvdyBmYWxsYmFjayBjb21wYXRpYmlsaXR5XG4gIC8vIHdpdGggbm9uLXRvZ2dsZWFibGUgY29tcG9uZW50c1xuICBpZiAoIWUgfHwgY2hlY2tJc0FjdGl2ZShlLCBiaW5kaW5nKSA9PT0gZmFsc2UpIHJldHVybiBmYWxzZVxuXG4gIC8vIElmIHdlJ3JlIGNsaWNraW5nIGluc2lkZSB0aGUgc2hhZG93cm9vdCwgdGhlbiB0aGUgYXBwIHJvb3QgZG9lc24ndCBnZXQgdGhlIHNhbWVcbiAgLy8gbGV2ZWwgb2YgaW50cm9zcGVjdGlvbiBhcyB0byBfd2hhdF8gd2UncmUgY2xpY2tpbmcuIFdlIHdhbnQgdG8gY2hlY2sgdG8gc2VlIGlmXG4gIC8vIG91ciB0YXJnZXQgaXMgdGhlIHNoYWRvd3Jvb3QgcGFyZW50IGNvbnRhaW5lciwgYW5kIGlmIGl0IGlzLCBpZ25vcmUuXG4gIGNvbnN0IHJvb3QgPSBhdHRhY2hlZFJvb3QoZWwpXG4gIGlmIChcbiAgICB0eXBlb2YgU2hhZG93Um9vdCAhPT0gJ3VuZGVmaW5lZCcgJiZcbiAgICByb290IGluc3RhbmNlb2YgU2hhZG93Um9vdCAmJlxuICAgIHJvb3QuaG9zdCA9PT0gZS50YXJnZXRcbiAgKSByZXR1cm4gZmFsc2VcblxuICAvLyBDaGVjayBpZiBhZGRpdGlvbmFsIGVsZW1lbnRzIHdlcmUgcGFzc2VkIHRvIGJlIGluY2x1ZGVkIGluIGNoZWNrXG4gIC8vIChjbGljayBtdXN0IGJlIG91dHNpZGUgYWxsIGluY2x1ZGVkIGVsZW1lbnRzLCBpZiBhbnkpXG4gIGNvbnN0IGVsZW1lbnRzID0gKCh0eXBlb2YgYmluZGluZy52YWx1ZSA9PT0gJ29iamVjdCcgJiYgYmluZGluZy52YWx1ZS5pbmNsdWRlKSB8fCAoKCkgPT4gW10pKSgpXG4gIC8vIEFkZCB0aGUgcm9vdCBlbGVtZW50IGZvciB0aGUgY29tcG9uZW50IHRoaXMgZGlyZWN0aXZlIHdhcyBkZWZpbmVkIG9uXG4gIGVsZW1lbnRzLnB1c2goZWwpXG5cbiAgLy8gQ2hlY2sgaWYgaXQncyBhIGNsaWNrIG91dHNpZGUgb3VyIGVsZW1lbnRzLCBhbmQgdGhlbiBpZiBvdXIgY2FsbGJhY2sgcmV0dXJucyB0cnVlLlxuICAvLyBOb24tdG9nZ2xlYWJsZSBjb21wb25lbnRzIHNob3VsZCB0YWtlIGFjdGlvbiBpbiB0aGVpciBjYWxsYmFjayBhbmQgcmV0dXJuIGZhbHN5LlxuICAvLyBUb2dnbGVhYmxlIGNhbiByZXR1cm4gdHJ1ZSBpZiBpdCB3YW50cyB0byBkZWFjdGl2YXRlLlxuICAvLyBOb3RlIHRoYXQsIGJlY2F1c2Ugd2UncmUgaW4gdGhlIGNhcHR1cmUgcGhhc2UsIHRoaXMgY2FsbGJhY2sgd2lsbCBvY2N1ciBiZWZvcmVcbiAgLy8gdGhlIGJ1YmJsaW5nIGNsaWNrIGV2ZW50IG9uIGFueSBvdXRzaWRlIGVsZW1lbnRzLlxuICByZXR1cm4gIWVsZW1lbnRzLnNvbWUoZWwgPT4gZWwuY29udGFpbnMoZS50YXJnZXQgYXMgTm9kZSkpXG59XG5cbmZ1bmN0aW9uIGNoZWNrSXNBY3RpdmUgKGU6IFBvaW50ZXJFdmVudCwgYmluZGluZzogQ2xpY2tPdXRzaWRlRGlyZWN0aXZlKTogYm9vbGVhbiB8IHZvaWQge1xuICBjb25zdCBpc0FjdGl2ZSA9ICh0eXBlb2YgYmluZGluZy52YWx1ZSA9PT0gJ29iamVjdCcgJiYgYmluZGluZy52YWx1ZS5jbG9zZUNvbmRpdGlvbmFsKSB8fCBkZWZhdWx0Q29uZGl0aW9uYWxcblxuICByZXR1cm4gaXNBY3RpdmUoZSlcbn1cblxuZnVuY3Rpb24gZGlyZWN0aXZlIChlOiBQb2ludGVyRXZlbnQsIGVsOiBIVE1MRWxlbWVudCwgYmluZGluZzogQ2xpY2tPdXRzaWRlRGlyZWN0aXZlLCB2bm9kZTogVk5vZGUpIHtcbiAgY29uc3QgaGFuZGxlciA9IHR5cGVvZiBiaW5kaW5nLnZhbHVlID09PSAnZnVuY3Rpb24nID8gYmluZGluZy52YWx1ZSA6IGJpbmRpbmcudmFsdWUhLmhhbmRsZXJcblxuICBlbC5fY2xpY2tPdXRzaWRlIS5sYXN0TW91c2Vkb3duV2FzT3V0c2lkZSAmJiBjaGVja0V2ZW50KGUsIGVsLCBiaW5kaW5nKSAmJiBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICBjaGVja0lzQWN0aXZlKGUsIGJpbmRpbmcpICYmIGhhbmRsZXIgJiYgaGFuZGxlcihlKVxuICB9LCAwKVxufVxuXG5mdW5jdGlvbiBoYW5kbGVTaGFkb3cgKGVsOiBIVE1MRWxlbWVudCwgY2FsbGJhY2s6IEZ1bmN0aW9uKTogdm9pZCB7XG4gIGNvbnN0IHJvb3QgPSBhdHRhY2hlZFJvb3QoZWwpXG5cbiAgY2FsbGJhY2soZG9jdW1lbnQpXG5cbiAgaWYgKHR5cGVvZiBTaGFkb3dSb290ICE9PSAndW5kZWZpbmVkJyAmJiByb290IGluc3RhbmNlb2YgU2hhZG93Um9vdCkge1xuICAgIGNhbGxiYWNrKHJvb3QpXG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IENsaWNrT3V0c2lkZSA9IHtcbiAgLy8gW2RhdGEtYXBwXSBtYXkgbm90IGJlIGZvdW5kXG4gIC8vIGlmIHVzaW5nIGJpbmQsIGluc2VydGVkIG1ha2VzXG4gIC8vIHN1cmUgdGhhdCB0aGUgcm9vdCBlbGVtZW50IGlzXG4gIC8vIGF2YWlsYWJsZSwgaU9TIGRvZXMgbm90IHN1cHBvcnRcbiAgLy8gY2xpY2tzIG9uIGJvZHlcbiAgaW5zZXJ0ZWQgKGVsOiBIVE1MRWxlbWVudCwgYmluZGluZzogQ2xpY2tPdXRzaWRlRGlyZWN0aXZlLCB2bm9kZTogVk5vZGUpIHtcbiAgICBjb25zdCBvbkNsaWNrID0gKGU6IEV2ZW50KSA9PiBkaXJlY3RpdmUoZSBhcyBQb2ludGVyRXZlbnQsIGVsLCBiaW5kaW5nLCB2bm9kZSlcbiAgICBjb25zdCBvbk1vdXNlZG93biA9IChlOiBFdmVudCkgPT4ge1xuICAgICAgZWwuX2NsaWNrT3V0c2lkZSEubGFzdE1vdXNlZG93bldhc091dHNpZGUgPSBjaGVja0V2ZW50KGUgYXMgUG9pbnRlckV2ZW50LCBlbCwgYmluZGluZylcbiAgICB9XG5cbiAgICBoYW5kbGVTaGFkb3coZWwsIChhcHA6IEhUTUxFbGVtZW50KSA9PiB7XG4gICAgICBhcHAuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNsaWNrLCB0cnVlKVxuICAgICAgYXBwLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIG9uTW91c2Vkb3duLCB0cnVlKVxuICAgIH0pXG5cbiAgICBpZiAoIWVsLl9jbGlja091dHNpZGUpIHtcbiAgICAgIGVsLl9jbGlja091dHNpZGUgPSB7XG4gICAgICAgIGxhc3RNb3VzZWRvd25XYXNPdXRzaWRlOiB0cnVlLFxuICAgICAgfVxuICAgIH1cblxuICAgIGVsLl9jbGlja091dHNpZGVbdm5vZGUuY29udGV4dCEuX3VpZF0gPSB7XG4gICAgICBvbkNsaWNrLFxuICAgICAgb25Nb3VzZWRvd24sXG4gICAgfVxuICB9LFxuXG4gIHVuYmluZCAoZWw6IEhUTUxFbGVtZW50LCBiaW5kaW5nOiBDbGlja091dHNpZGVEaXJlY3RpdmUsIHZub2RlOiBWTm9kZSkge1xuICAgIGlmICghZWwuX2NsaWNrT3V0c2lkZSkgcmV0dXJuXG5cbiAgICBoYW5kbGVTaGFkb3coZWwsIChhcHA6IEhUTUxFbGVtZW50KSA9PiB7XG4gICAgICBpZiAoIWFwcCB8fCAhZWwuX2NsaWNrT3V0c2lkZT8uW3Zub2RlLmNvbnRleHQhLl91aWRdKSByZXR1cm5cblxuICAgICAgY29uc3QgeyBvbkNsaWNrLCBvbk1vdXNlZG93biB9ID0gZWwuX2NsaWNrT3V0c2lkZVt2bm9kZS5jb250ZXh0IS5fdWlkXSFcblxuICAgICAgYXBwLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbGljaywgdHJ1ZSlcbiAgICAgIGFwcC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBvbk1vdXNlZG93biwgdHJ1ZSlcbiAgICB9KVxuXG4gICAgZGVsZXRlIGVsLl9jbGlja091dHNpZGVbdm5vZGUuY29udGV4dCEuX3VpZF1cbiAgfSxcbn1cblxuZXhwb3J0IGRlZmF1bHQgQ2xpY2tPdXRzaWRlXG4iXX0=